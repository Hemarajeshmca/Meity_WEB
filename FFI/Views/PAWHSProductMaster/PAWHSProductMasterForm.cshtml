@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    ViewBag.Form = "Product Master";
    Layout = "~/Views/Shared/FormViewLayout1.cshtml";
}

<form id="Product_form" class="form-horizontal" data-role="validator" novalidate="novalidate">
    <div class="panel panel-default">
        <div class="panel-body" style="padding-top:20px;padding-bottom:20px">
            <div class="row" style="padding-bottom:1px">
                <div class="col-xs-4">
                    <div class="form-group">
                        <label for="cmb_season" class="col-sm-5 control-label required">Season</label>
                        <div class="col-sm-6" id="dropdwnSeason">
                            <input id="cmb_season" name="In_cmb_season" data-role="filtercombo" style="width:100%">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txt_produ_sub_cate" class="col-sm-4 control-label">Product Category</label>
                        <div class=" col-sm-6">
                            <input id="txt_produ_sub_cate" name="In_product_category" style="width: 100%" data-role="filtercombo" />
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="form-group">
                        <label for="txt_pro_name" class="col-sm-5 control-label required">Product SubCategory</label>
                        <div class=" col-sm-6">
                            <input id="txt_pro_name" name="In_product_subcategory" style="width: 100%" data-role="filtercombo">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="padding-bottom:5px">
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txt_crop_varity" class="col-sm-5 control-label required">Product Name</label>
                        <div class=" col-sm-6">
                            <input type="text" id="txt_crop_variety" name="In_crop_variety" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txt_uom" class="col-sm-4 control-label required">UOM</label>
                        <div class=" col-sm-6" id="dropdwn">
                            <input id="txt_uom" name="In_uomtype_code" style="width: 100%" data-role="filtercombo">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="form-group">
                        <label for="txt_hsn_code" class="col-sm-5 control-label required">HSN Code</label>
                        <div class=" col-sm-6">
                            <input type="text" id="txt_hsn_code" name="In_hsn_code" class="form-control" maxlength="50">
                        </div>
                        <div id="pay_help1">
                            <a class="HelpWindow fa fa-search fa-lg" role="button" id="pay_help2" data-toggle="modal" href="../HelpFilter/HelpFilter" hdrtitle="HSN Code" searchid="S119" data-target="#HelpModal" onclick=transfer(this,"form","","form_control1"); title="Search" style="font-size: 19px; margin-left: 0px; margin-top: 10px;"></a>
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txt_produ_hsn_desc" class="col-sm-5 control-label">HSN Description</label>
                        <div class=" col-sm-6">
                            <input type="text" id="txt_produ_hsn_desc" name="In_hsn_description" class="form-control" maxlength="50" readonly>
                            <input type="hidden" id="txtitem_rowid" name="IOU_product_rowid">
                            <input type="hidden" id="txtagg_code" name="In_agg_code">
                            <input type="hidden" id="txt_pawhs_code" name="IOU_pawhs_code">
                            <input type="hidden" id="txt_product_code" name="In_product_code">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <input type="radio" id="valuewith" name="In_valuewithtax" value="Yes" style="margin-left:4%; font-weight: bold;" /> Value Added Product
                        <input type="radio" id="valuewithout" name="In_valuewithtax" value="No" style="margin-left: 29px;font-weight: bold;" /> Non Value Added Product
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group" style="display:none;">
                        <label for="status_code" class=" col-sm-3 control-label">Status_code</label>
                        <div class="col-sm-4">
                            <input type="text" value="A" id="txt_status_code" name="In_status_code" class="form-control" maxlength="10">
                            <input type="hidden" id="txt_status_DESC" name="In_status_desc" value="Active" />
                        </div>
                    </div>
                </div>              
                <div class="col-sm-6">
                    <div class="form-group" style="display:none;">
                        <label for="txtMode" class=" col-sm-3 control-label">Mode</label>
                        <div class="col-sm-4">
                            <input type="text" id="txtMode" name="In_mode_flag" class="form-control" maxlength="10" value="I">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group" style="display:none;">
                        <label for="row_timestamp" class=" col-sm-3 control-label">Timestamp:</label>
                        <div class="col-sm-4">
                            <input type="text" id="txt_row_timestamp" name="In_row_timestamp" class="form-control" maxlength="10">
                        </div>
                    </div>
                </div>
            </div>           
            <div class="row" style="padding-bottom:20px">
                <div class="col-xs-12">
                    <div id="Itm_mst"></div>
                </div>
            </div>

        </div>
    </div>
</form>
<script>
    click_act_name = "PAWHSProductMasterList";
    click_ctrl_name = "PAWHSProductMaster";
    form_list_url = '../' + click_ctrl_name + '/' + click_act_name;
</script>
<script src="~/API_Scripts/Item_Master_PAWHS_getItemMaster_APIClient.js"></script>
<script src="~/API_Scripts/Item_Master_PAWHS_getItemMasterList_APIClient.js"></script>
<script src="~/API_Scripts/Item_Master_PAWHS_saveItemMaster_APIClient.js"></script>
<script src="~/API_Scripts/PAWHS_getItemMaster_Model.js"></script>
<script src="~/API_Scripts/PAWHS_getItemMasterList_Model.js"></script>
<script src="~/API_Scripts/PAWHS_saveItemMaster_Model.js"></script>
<script src="~/API_Scripts/PAWHSItemmaster.js"></script>
<script src="~/API_Scripts/UmoldITWebAPIProxy.js"></script>
<script src="~/CommonScripts/HelpFile.js"></script>
<script src="~/CommonScripts/common.js"></script>

<script>
    $(document).ready(function () {
        debugger;
        kendodate_format();
        ITMMST();
        $("#bottom_menus").hide();
        $("#divCreate").hide();
        $("#divEdit").hide();
        $("#divView").hide();
        $('#frmlayerdiv').hide();
        $('#divUserRole8').show();
        $('#divUserRole8 #review').hide();
        $("#hide_div").hide();
        $("#divScreen").hide();

        $("#btnadd").hide();
            if (@Configuration.GetSection("AppSettings")["HideAddProductMaster"].ToString()!= true) {
                $("#btnadd").show();
            }
        Form_validate_Name = $('form.form-horizontal').attr('id');
        var container = $("#Product_form");
        kendo.init(container);
        container.kendoValidator({
        });
        Screen_Id = "PWPRODUCTMAS";
        permission = sec_Permission(Screen_Id);
        setlocalStorage('screen', Screen_Id);
        setlocalStorage("procrowid", "");
        setlocalStorage("process", "PWPRODUCTMAS");
        load_master_code();
        seasonload();
        
        var uom_type = "";
        $("#txt_uom").empty();
        uom_type = grid_comboScreen_mastercodes("QCD_UOM_TYPE");
        filter_combobox("txt_uom", uom_type);
        $("#cmb_item_type").empty();
        share_cert = grid_comboScreen_mastercodes("QCD_PAWHS_UOM");
        filter_combobox("cmb_item_type", share_cert);
        $("#txt_produ_sub_cate").empty();
        $("#txt_pro_name").empty();
       

        $(".file_attach").attr("hdrtitle", "HSN");
        $(".notes").attr("hdrtitle", "HSN");
        $("#lblForm_menuid").text("PWPRODUCTMAS");

        var org_id = getlocalStorage('org_id');
        var org_type = getlocalStorage('org_type');
        var orgtname = getlocalStorage('orgtname');
        var org = getlocalStorage('org');
        $('#txtagg_code').val(org_id);

        function seasonload() {
            debugger;
            var state_code = getlocalStorage("fpo_state_code");
            console.log(state_code);
            var data1 = { State_code: state_code}
            $.ajax({
            url: '@Url.Action("GetSeasonList", "PAWHSProductMaster")',
            type: "post",
            contentType: 'application/x-www-form-urlencoded',
            data: data1,
            success: function (response1) {
            debugger;
                var url_path = JSON.parse(response1);
                var itemArrFPO = [];
                for (var i = 0; i < url_path.length; i++) {
                    var list = {};
                    list.id = url_path[i].serial_number;
                    list.code = url_path[i].master_code;
                    list.desc = url_path[i].master_name;
                    itemArrFPO.push(list);
                }
                filter_combobox("cmb_season", itemArrFPO);
            },
                error: function (er)
                {
                alert(er)
                console.log(er)
                }
            });
    }
        if (getlocalStorage('btn_clk_val') == "Create") {
            $('#frmlayerdiv').show();
            $('#divCreate #review').hide();
            $("#txtMode").val("I");
            $("#bottom_menus").hide();
            $("#DocStat").val("New");

        }
        else if (getlocalStorage('btn_clk_val') == "Edit") {
            debugger;
            $('#divEdit #reviewEd').hide();
            $('#frmlayerdiv').show();
            $('#cmb_season').prop("disabled", true);
            $('#txt_produ_sub_cate').prop("disabled", true);
            $('#txt_pro_name').prop("disabled", true);
            if (getlocalStorage("ls_pageList") != undefined) {
                var data = getlocalStorage("ls_pageList");
                var formval = form_Serialize("Product_form");
                var obj_val = JSON.parse(formval);
                obj_val.IOU_product_rowid = data.Out_product_rowid;
                obj_val.IOU_pawhs_code = data.Out_pawhs_code;
                obj_val.IOU_agg_code = data.Out_agg_code;
                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                //Item Master Edit Binding  start 18-05-2020
                var Context = data.context;
                $.ajax({
                    type: "POST",
                    data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, Header: Context.Header }),
                    url: "/PAWHSProductMaster/ProductMasterfetch",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        if (response.context != null) {
                            debugger;
                            generate_ItemMaster_header(response.context.Header);
                            generate_ItemMaster_list(response.context.Detail);
                            load_master_code();
                        }
                        else {
                            console.log(response);
                        }
                    },
                    error: function (er) {
                        alert(er);
                        console.log(er);
                    }

                });               
                $("#txtMode").val("U");
                $("#DocStat").val("Active");
                if (getlocalStorage('btn_clk_val') == "View") {
                    $('#divEdit #reviewEd').hide();
                    $('#divEdit #deactivate').hide();
                    $("#bottom_menus li:nth-child(1)").hide();
                    $("#bottom_menus li:nth-child(3)").hide();
                    $('#divUserRole8 #review').hide();
                    $('#divUserRole8 #btnSave').hide();
                    viewdisable();
                }
            }
        }
        else if (getlocalStorage('btn_clk_val') == "View") {
            $('#frmlayerdiv').show();
            $('#divEdit #reviewEd').hide();
            $('#divEdit #deactivate').hide();
            $("#bottom_menus li:nth-child(1)").hide();
            $("#bottom_menus li:nth-child(3)").hide();
            $('#divUserRole8 #review').hide();
            $('#divUserRole8 #btnSave').hide();
            viewdisable();
            if (getlocalStorage("ls_pageList") != undefined) {
                var data = getlocalStorage("ls_pageList");
                var formval = form_Serialize("Product_form");
                var obj_val = JSON.parse(formval);
                obj_val.IOU_product_rowid = data.Out_product_rowid;
                obj_val.IOU_pawhs_code = data.Out_pawhs_code;
                obj_val.IOU_agg_code = data.Out_agg_code;
                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                //Item Master Edit Binding  start 18-05-2020
                var Context = data.context;
                $.ajax({
                    type: "POST",
                    data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, Header: Context.Header }),
                    url: "/PAWHSProductMaster/ProductMasterfetch",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        if (response.context != null) {
                            debugger;
                            generate_ItemMaster_header(response.context.Header);
                            generate_ItemMaster_list(response.context.Detail);

                        }
                        else {
                            console.log(response);
                        }
                    },
                    error: function (er) {
                        alert(er);
                        console.log(er);
                    }

                });
                field_enable();
                $("#txtMode").val("U");
                $("#DocStat").val("Active");
            }
           
        }
        function field_enable() {
                $("#pay_help2").hide();
                $('#cmb_season').prop("disabled", true);
                $('#txt_produ_sub_cate').prop("disabled", true);
                $('#txt_pro_name').prop("disabled", true);
                $('#txt_crop_variety').prop("disabled", true);
                $('#txt_produ_cate').prop("disabled", true);
                $("#valuewith").prop("disabled", true);
                $("#valuewithout").prop("disabled", true);
                $("#dropdwn option").attr("disabled", "true");
                var dropdwns = $("#txt_uom").data("kendoComboBox");
                dropdwns.readonly();
        }
    });

    //prema added on 23 Sep 22
    $("#cmb_season").change(function () {
        debugger;
      //  $('#txt_produ_sub_cate').data("kendoComboBox").value('');
        var category = $('#cmb_season').data("kendoComboBox").value();
        console.log(category);

        var data1 = { Season_code: category}
            $.ajax({
            url: '@Url.Action("GetProductCatList", "PAWHSProductMaster")',
            type: "post",
            contentType: 'application/x-www-form-urlencoded',
            data: data1,
            success: function (response1) {
            debugger;
                var url_path = JSON.parse(response1);
                var itemArrFPO = [];
                for (var i = 0; i < url_path.length; i++) {
                    var list = {};
                    list.id = url_path[i].serial_number;
                    list.code = url_path[i].master_code;
                    list.desc = url_path[i].master_name;
                    itemArrFPO.push(list);
                }
                filter_combobox("txt_produ_sub_cate", itemArrFPO);
            },
                error: function (er)
                {
                alert(er)
                console.log(er)
                }
            });

    });
    $("#txt_produ_sub_cate").change(function () {
        debugger;
        var category = $('#txt_produ_sub_cate').data("kendoComboBox").value();
        console.log(category);
        var data1 = { prdcat_code: category}
            $.ajax({
            url: '@Url.Action("GetProductSUBCatList", "PAWHSProductMaster")',
            type: "post",
            contentType: 'application/x-www-form-urlencoded',
            data: data1,
            success: function (response1) {
            debugger;
                var url_path = JSON.parse(response1);
                var itemArrFPO = [];
                for (var i = 0; i < url_path.length; i++) {
                    var list = {};
                    list.id = url_path[i].serial_number;
                    list.code = url_path[i].master_code;
                    list.desc = url_path[i].master_name;
                    itemArrFPO.push(list);
                }
                filter_combobox("txt_pro_name", itemArrFPO);
            },
                error: function (er)
                {
                alert(er)
                console.log(er)
                }
            });

    });

    function load_master_code() {
        try {
            debugger;
            var data = {};
            var context = WebAPIProxy.getContext();
            data.userId = context.userId
            data.orgnId = context.orgnId
            data.locnId = context.locnId
            data.localeId = context.localeId
            data.screen_Id = "PWPRODUCTMAS";
            var tab_values = ajaxcall_param("/Home/screenId_mastercodelist", JSON.stringify(data));
        }

        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    var data = [];
    function ITMMST(data) {
        try {
            $("#Itm_mst").kendoGrid({
                dataSource: {
                    data: data,
                    schema: {
                        model: {
                            fields: {

                                In_product_dtl_rowid: { type: "int", defaultValue: 0 },
                                In_pawhs_code: { type: "string" },
                                In_row_slno: { type: "int", defaultValue: 1 },
                                In_maize_code: { type: "string" },
                                In_maize_name: { type: "string" },
                                In_range: { type: "string", editable: false },
                                In_min_value: { type: "int", defaultValue: 0 },
                                In_max_value: { type: "int", defaultValue: 0 },
                                In_maize_interval: { type: "string", editable: false },
                                In_maize_unit: { type: "string", editable: false },
                                In_temp_min_value: { type: "int", defaultValue: 0 },
                                In_temp_max_value: { type: "int", defaultValue: 0 },
                                In_status_code: { type: "string" },
                                In_mode_flag: { type: "string", defaultValue: "I" }

                            }
                        }
                    }
                },
                toolbar: "<a  class='k-grid-add' id='btnSave' href=''><span class='fa fa-plus' style='color:Black'></span></a>",
                height: 280,
                groupable: false,
                edit: OnEdit,
                sortable: true,
                selectable: true,
                navigatable: true,
                columns: [{

                    command: [
                        {
                            name: "Delete",
                            id: "Delete",
                            imageClass: "fa fa-close",
                            click: function (e) {
                                var grid = $("#Itm_mst").data("kendoGrid");
                                var dataItem = $("#Itm_mst").data("kendoGrid").dataItem($(e.target).closest("tr"));
                                DeleteWindowEvent(e, dataItem, grid);
                                e.stopImmediatePropagation()
                            }
                        },
                    ],
                    title: "Action",
                    width: "25px",

                },


                {
                    field: "In_product_dtl_rowid",
                    title: "productrowid",
                    width: 15,
                    hidden: true,

                },
                {
                    field: "In_pawhs_code",
                    title: "PAWHS Code",
                    hidden: true,
                    width: 50,
                },

                {
                    field: "In_maize_name",
                    title: "Quality",
                    editor: Getproduct,
                    //editor: function (container, options) {
                    //    combo_editor_man(container, "cmb_" + options.field, eval(options.field + "_list"), options.field, "In_maize_code", "Itm_mst")
                    //},
                    editable: true,
                    width: 60,

                },

                {
                    field: "In_maize_code",
                    title: "Quality_code",
                    hidden: true,
                    width: 100,
                },
                {
                    field: "In_range",
                    title: "Range",
                    width: 50,
                },
                {
                    field: "In_min_value",
                    title: "Min Value",
                    width: 50,
                    attributes: { style: "text-align:right;", "class": "customClass" },
                    editor: function (container, options) {
                        item_rate(container, options.field, '9', '2');
                    },
                    hidden: true,
                },
                {
                    field: "In_max_value",
                    title: "Max Value",
                    width: 50,
                    attributes: { style: "text-align:right;", "class": "customClass" },
                    editor: function (container, options) {
                        item_rate(container, options.field, '9', '2');
                    },
                    hidden: true,
                },
                {
                    field: "In_maize_interval",
                    title: "Interval",
                    width: 40,
                },
                {
                    field: "In_maize_unit",
                    title: "Unit",
                    width: 50,
                },
                {
                    field: "In_status_code",
                    title: "Status",
                    editor: function (container, options) {
                        combo_editor_man(container, "cmb_" + options.field, eval(options.field + "_list"), options.field, "", "Itm_mst")
                    },
                    hidden: true,
                    width: 50,

                },

                {
                    field: "In_temp_min_value",
                    title: "min values",
                    hidden: true,

                },
                {
                    field: "In_temp_max_value",
                    title: "max values",
                    hidden: true,

                },

                {
                    field: "In_mode_flag",
                    title: "Mode",
                    hidden: true
                }
                ],
                editable: true
            });
        }
        catch (err) {
            alert(err);
        }
        load_master_code();
        //In_maize_name_list = grid_comboScreen_mastercodes("QCD_PAWHS_QTY");
        In_status_code_list = grid_comboScreen_mastercodes("QCD_PAWHS_STS");


        function OnEdit(e) {
            setDefaultValues(e);
            e.container.find("input[name='expense_amount']").focusout(function () {

                var grid = $("#Itm_mst").data("kendoGrid");
                var gridData = grid.dataSource.view();
            });
        }
    }

    function Getproduct(container, options) {
        debugger;
        var gridDataArray = $('#Itm_mst').data('kendoGrid')._data;
        $('<div class="input-group input-group-sm"><input type="text" readonly name="product_code" maxlength="10" style="width:100px;color:black"  onkeypress="return speical_char(event)" data-bind="value:product_code"/><span class="input-group-btn" style="padding-right: 90px;"><a class="HelpWindow fa fa-search fa-lg" data-toggle="modal" href="/HelpFilter/HelpFilter" hdrtitle="Qty List" searchid="M01" data-target="#HelpModal" onclick=transfer(this,"grid","Itm_mst","ITMMST") title="Search" style="font-size: 15px; padding-left: 10px;"></a> </span> </div>').appendTo(container);
    }



    function generate_ItemMaster_list(res) {
        debugger;
        try {
            if (res != null) {
                var data = changedataType(res);
                $("#Itm_mst").empty();
                $("#Itm_mst").append("<div id='Item_tran_grid'></div>");
                ITMMST(data);
                var rows = $('#Itm_mst tbody tr');
                $.map(rows, function (row) {
                    //cell buttons index
                    row.cells[0].innerHTML = "";

                });
                var rows = $('#Itm_mst tbody tr');
                $.map(rows, function (row) {
                    //cell buttons index
                    row.cells[0].innerHTML = "";

                });
                //$("#Itm_mst").find("table th").eq(1).hide();
            }
            else {
                ITMMST([]);
                //var grid = $("#Itm_mst").data("kendoGrid");
                //grid.hideColumn(1);

                //$("#Itm_mst").kendoGrid({
                //    columns: [
                //      { hidden: true, id: "Delete" },
                //    ],
                //});

                $("#Itm_mst").find("table th").eq(1).hide();
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function get_ItemMaster_details(res) {
        try {

            $("#txt_pawhs_code").val(res.IOU_pawhs_code);
            $("#txt_pro_cde").val(res.In_product_code);
            var formval = form_Serialize("Product_form");
            var obj_val = JSON.parse(formval);
            obj_val.IOU_product_rowid = res.IOU_product_rowid;
            obj_val.IOU_pawhs_code = res.IOU_pawhs_code;
            obj_val.IOU_agg_code = res.In_agg_code;



            var data = {};
            data.context = WebAPIProxy.getContext();
            data.context.Header = obj_val;
            //Item Master Edit Binding  start 18-05-2020
            var Context = data.context;
            $.ajax({
                type: "POST",
                data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, Header: Context.Header }),
                url: "/PAWHSProductMaster/ProductMasterfetch",
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    if (response.context != null) {
                        debugger;
                        generate_ItemMaster_header(response.context.Header);
                        generate_ItemMaster_list(response.context.Detail);

                    }
                    else {
                        console.log(response);
                    }
                },
                error: function (er) {
                    alert(er);
                    console.log(er);
                }

            });

            //Item Master Edit Binding  End


            /// retrieve_ItemMaster_details(data);
            $("#txt_pawhs_code").val(res.IOU_pawhs_code);
            //$("#txt_pro_cde").val(res.In_product_code);
            $("#txtitem_rowid").val(res.IOU_product_rowid);
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>


<script>

    function grid_control() {
        debugger;
        try {
            var control_Name = [
                { "dataCol": "", "grid_row_col": "In_product_dtl_rowid" },
                { "dataCol": "", "grid_row_col": "In_pawhs_code" },
                { "dataCol": "", "grid_row_col": "In_row_slno" },
                { "dataCol": "maize_code", "grid_row_col": "In_maize_code" },
                { "dataCol": "maize_name", "grid_row_col": "In_maize_name" },
                { "dataCol": "maize_range", "grid_row_col": "In_range" },
                { "dataCol": "", "grid_row_col": "In_min_value" },
                { "dataCol": "", "grid_row_col": "In_max_value" },
                { "dataCol": "maize_interval", "grid_row_col": "In_maize_interval" },
                { "dataCol": "maize_unit", "grid_row_col": "In_maize_unit" },
                { "dataCol": "min_value", "grid_row_col": "In_temp_min_value" },
                { "dataCol": "max_value", "grid_row_col": "In_temp_max_value" },
                { "dataCol": "", "grid_row_col": "In_mode_flag" },
                { "dataCol": "", "grid_row_col": "In_status_code" },
                { "dataCol": "", "grid_row_col": "uid" }


            ];
            return control_Name
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    function form_control() {
        debugger;
        var control_Name = [
            //{ "dataCol": "taxrate_rowid", "controlId": "txt_taxrate", "type": "Text" },
            //{ "dataCol": "CROPName_Mst", "controlId": "txt_CropNamecode", "type": "Text" },
            //{ "dataCol": "CROPNAME_Desc", "controlId": "txt_pro_name", "type": "Text" },
            //{ "dataCol": "CROPCLASS_Mst", "controlId": "txt_Prcccode", "type": "Text" },
            //{ "dataCol": "CROPCLASS", "controlId": "txt_produ_cate", "type": "Text" },
            //{ "dataCol": "CROPTYPE_Mst", "controlId": "txt_proscode", "type": "Text" },
            //{ "dataCol": "CROPTYPE_Desc", "controlId": "txt_produ_sub_cate", "type": "Text" },

            // Sheeba Commented and Implemented
            { "dataCol": "crop_name_code", "controlId": "txt_CropNamecode", "type": "Text" },
            { "dataCol": "crop_name", "controlId": "txt_pro_name", "type": "Text" },
            { "dataCol": "crop_class_code", "controlId": "txt_Prcccode", "type": "Text" },
            { "dataCol": "crop_class", "controlId": "txt_produ_cate", "type": "Text" },
            { "dataCol": "crop_type_code", "controlId": "txt_proscode", "type": "Text" },
            { "dataCol": "crop_type", "controlId": "txt_produ_sub_cate", "type": "Text" },


        ];
        return control_Name;
    }

    function form_control1() {
        debugger;
        var control_Name = [
            { "dataCol": "HSN_code", "controlId": "txt_hsn_code", "type": "Text" },
            { "dataCol": "hsn_description", "controlId": "txt_produ_hsn_desc", "type": "Text" },
            { "dataCol": "hsn_description", "controlId": "txt_hsndesc", "type": "Text" },
            { "dataCol": "HSN_uom", "controlId": "txt_uom", "type": "Text" },
        ];
        return control_Name;
    }
    function trans_input_data() {
        try {
            var trans_coll = [

                { "trasfer": "NO", "dataCol": "", "controlId": "", "grid_id": "", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "ic_code", "controlId": "ic_code", "grid_id": "", "grid_row_col": "" },
                //{ "trasfer": "Yes", "dataCol": "CROPTYPE", "controlId": "txt_produ_sub_cate", "grid_id": "", "grid_row_col": "" },
                //{ "trasfer": "Yes", "dataCol": "CROPNAME", "controlId": "txt_pro_name", "grid_id": "", "grid_row_col": "" },
                //  { "trasfer": "Yes", "dataCol": "In_receipt_ref_doc_no", "controlId": "In_receipt_ref_doc_no", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "crop_class", "controlId": "txt_produ_cate", "grid_id": "", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "crop_type", "controlId": "txt_produ_sub_cate", "grid_id": "", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "crop_name", "controlId": "txt_pro_name", "grid_id": "", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "product_catg_desc", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "adjustment_desc", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "adjustment_desc", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "In_receipt_ref_doc_no", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "product_code", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "product_desc", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" },
                { "trasfer": "Yes", "dataCol": "uom_desc", "controlId": "", "grid_id": "grid_prodc_adj", "grid_row_col": "" }
            ];
            return trans_coll;
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>


<script>
    function viewdisable() {
        debugger;
        $("#chk-rg").attr("disabled", true);
        $("#chk_wip").attr("disabled", true);
        $("#chk_Fg").attr("disabled", true);
        $("#chk_Service").attr("disabled", true);

    }

</script>
<script>
    function DeleteWindowEvent(e, dataItem, grid) {
        debugger;
        e.preventDefault();
        if (dataItem.mode_flag != "I") {
            var kendoWindow = $("<div />").kendoWindow({
                title: "Confirm",
                width: "350px",
                height: "130px",
                resizable: false,
                modal: true
            });
            kendoWindow.data("kendoWindow")
                .content($("#grid_delete-confirmation").html())
                .center().open();
            kendoWindow
                .find(".grid_delete-confirm,.grid_delete-cancel")
                .click(function () {
                    if ($(this).hasClass("grid_delete-confirm")) {
                        if (dataItem.mode_flag == "S" || dataItem.mode_flag == "U") {
                            dataItem.mode_flag = "D";
                            ($(e.target).closest("tr")).css('backgroundColor', '#ff3333');
                        }
                        else if (dataItem.mode_flag == "D") {
                            dataItem.mode_flag = "S";
                            ($(e.target).closest("tr")).css('backgroundColor', '');
                        }
                        else if (dataItem.mode_flag == undefined) {
                            grid.dataSource.remove(dataItem);
                            grid.dataSource.sync();
                        }

                    }
                    else {
                        if (dataItem.mode_flag == "D")
                            dataItem.mode_flag = "D";
                        else if (dataItem.mode_flag == "U")
                            dataItem.mode_flag = "U";
                        else if (dataItem.mode_flag == "S")
                            dataItem.mode_flag = "S";
                        kendoWindow.data("kendoWindow").close();
                    }
                    kendoWindow.data("kendoWindow").close();
                })
            //.end()
        }
        else {
            grid.dataSource.remove(dataItem);
            grid.dataSource.sync();

            var rows = grid.tbody.children();

            for (var j = 0; j < rows.length; j++) {
                var row = $(rows[j]);
                var dataItem = grid.dataItem(row);

                if (dataItem.mode_flag == "I") {
                    row.css('backgroundColor', 'lightgreen')
                }
                else if (dataItem.mode_flag == "D") {
                    grid.closeCell();
                    row.css('backgroundColor', '#ff3333')
                }
            }
        }

    };
</script>

<script>

    var item = "";
    var validate = false;
    function Validate() {
        if ($("#cmb_item_type").val() == "") {
            kendoAlert("UOM Cannot Be Balnk. Please Fill the UOM Field  Field");
            return false;
        }
        if ($("#txt_hsn_code").val() == "") {
            kendoAlert("HSN Code Cannot Be Balnk. Please Fill the HSN Code Field");
            return false;
        }
        var grid_val = JSON.stringify($("#Itm_mst").data().kendoGrid._data);
        var Bind = {};
        Bind = grid_val;
        var result = JSON.parse(Bind);
        var grid_validate_msg = "";
        if (result.length == 0) {
            kendoAlert("Atleast one record needs to be entered");
            //mandatory_check = false;
            return false;
        }
      
        else {
            validate = true;
        }
    }

    function save() {
        debugger;
        item = "";
        try {
            if ($("#txt_pro_name").val() == "") {
                kendoAlert("Crop Name Cannot Be Balnk. Please Fill the Crop Name Field");
                return false;
                validate = false;
            }
            else if ($("#txt_crop_variety").val() == "") {
                kendoAlert("Crop Variety Cannot Be Balnk. Please Fill the Crop Variety Field");
                return false;
                validate = false;
            }
            else {
                validate = true;
            }
            Validate();
            if (validate == true) {
                if ($("#txt_pawhs_code").val() == "") {
                    $("#txt_pawhs_code").val('0');
                }
                if ($("#txt_pro_cde").val() == "") {
                    $("#txt_pro_cde").val('0');
                }
                if ($("#txtitem_rowid").val() == "") {
                    $("#txtitem_rowid").val('0');
                }
                if ($("#txtagg_code").val() == "") {
                    $("#txtagg_code").val(' ');
                }
                if ($("#txt_produ_cate").val() == "") {
                    $("#txt_produ_cate").val('');
                }
                if ($("#txt_produ_sub_cate").val() == "") {
                    $("#txt_produ_sub_cate").val('');
                }
                if ($("#txt_pro_name").val() == "") {
                    $("#txt_pro_name").val('');
                }
                if ($("#txt_crop_variety").val() == "") {
                    $("#txt_crop_variety").val('');
                }
                var formval = form_Serialize("Product_form");
                var obj_val = JSON.parse(formval);
                var grid_val = JSON.stringify($("#Itm_mst").data().kendoGrid._data);
                var Bind = {};
                Bind = grid_val;
                var result = JSON.parse(Bind);
                var slno = 0;
                $.each(result, function (index, value) {
                    var row_id = value.In_product_dtl_rowid;
                    if (row_id == undefined || row_id == '') {
                        result[index].In_product_dtl_rowid = '0';
                    }
                    var mode = value.In_mode_flag;
                    if (mode == "") {
                        result[index].In_mode_flag = "I";
                    }
                    if (mode == "S") {
                        result[index].In_mode_flag = "U";
                    }
                    slno = slno + 1;
                    result[index].In_row_slno = slno;
                    result[index].In_status_code = "Active";
                });
                var obj_grid_val = result;
                if (obj_grid_val.length > 0) {
                    for (i = 0; i < obj_grid_val.length; i++) {
                        if (obj_grid_val[i].In_maize_name == "") {
                            kendoAlert("Kindly fill the Quality field.!!");
                            return false;
                        }
                    }
                    for (var i = 0; i < obj_grid_val.length; i++) {
                        var currentDataItem = obj_grid_val[i];
                        var qty1 = currentDataItem.In_maize_name.trim().toUpperCase();

                        for (var j = i + 1; j < obj_grid_val.length; j++) {
                            var nextDataItem = obj_grid_val[j];
                            var qty2 = nextDataItem.In_maize_name.trim().toUpperCase();

                            if (qty1 == qty2) {
                                kendoAlert("This " + qty1 + "Quality is already exists");
                                return false;

                            }
                        }
                    }
                    if (obj_val.In_valuewithtax == null || obj_val.In_valuewithtax == undefined || obj_val.In_valuewithtax == '') {
                        obj_val.In_valuewithtax = "No";
                    }
                    obj_val.In_item_type = item;
                    var data = {};
                    data.context = WebAPIProxy.getContext();
                    data.context.Header = obj_val;
                    data.context.Detail = obj_grid_val;
                    var Context = data.context;
                    console.log(Context);
                    //Item Master Save Start 18-05-2020
                    $.ajax({
                        type: "POST",
                        data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, Header: Context.Header, Detail: Context.Detail }),
                        url: "/PAWHSProductMaster/ProductMasterSave",
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        success: function (response) {
                            debugger;
                            console.log(response)
                            var Res = response;
                            var mode = $("#txtMode").val();
                            if (Res.ApplicationException.errorDescription == null || Res.ApplicationException.errorDescription == "") {
                                if (mode == "I") {
                                    kendoAlert("Product Master saved successfully");
                                    get_ItemMaster_details(Res.context.Header);
                                }
                                else if (mode == "D") {
                                    kendoAlert("Product Master inactivate successfully");
                                    get_ItemMaster_details(Res.context.Header);
                                }
                                else {
                                    kendoAlert("Product Master saved successfully");
                                    get_ItemMaster_details(Res.context.Header);
                                }
                                $("#txtMode").val("U");
                                $("#DocStat").val("Active");
                                var rows = $('#Itm_mst tbody tr');
                                $.map(rows, function (row) {
                                    //cell buttons index
                                    row.cells[0].innerHTML = "";

                                });

                            }
                            else {
                                kendoAlert(Res.ApplicationException.errorDescription);
                                $("#txtMode").val("I");
                            }
                        },
                        error: function (er) {
                            alert(er);
                            console.log(er);
                        }

                    });
                }

            }


        }

        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
 
    function generate_ItemMaster_header(res) {
        debugger;
        try {
            if (res != null) {
                $("#cmb_season").data("kendoComboBox").value(res.In_cmb_season);
                $("#txt_crop_variety").val(res.In_crop_variety);
                $("#txt_hsn_code").val(res.In_hsn_code);
                $("#txt_produ_hsn_desc").val(res.In_hsn_description);
                $("#txt_produ_sub_cate").val(res.In_product_subcategory);
                $("#txt_pro_name").val(res.In_product_name);
                $("#txt_uom").data("kendoComboBox").value(res.In_uomtype_code);    
                $("#txtMode").val("U");
                $("#DocStat").val("Active");
                $("#txtitem_rowid").val(res.IOU_product_rowid);
                //$("#txtagg_code").val(res.agg_code);
                $("#txt_pawhs_code").val(res.IOU_pawhs_code);
                $("#txt_pro_cde").val(res.In_product_code);              
                var PRDVALADD = res.In_valuewithtax;
                if (PRDVALADD == "Yes") {
                    $("#valuewith").prop('checked', true);
                }
                else if (PRDVALADD == "No") {
                    $('#valuewithout').prop('checked', true);
                }
                else if (PRDVALADD == "") {
                    $("#valuewith").prop('checked', false);
                    $('#valuewithout').prop('checked', false);
                }
                $("#txt_proscode").val(res.In_status_desc);   
                $("#txt_hsndesc").val(res.In_hsn_description);     
                $("#txt_pro_name").data("kendoComboBox").value(res.In_product_name);
                $("#txt_uom").data("kendoComboBox").value(res.In_uomtype_code);
                //$("#txt_UOM_txt").val(res.In_uomtype_code_mst);
                $("#txtMode").val("U");
                var category = $('#txt_produ_sub_cate').data("kendoComboBox").text();
                for (var i = 0; i < ($('#txt_pro_name').data("kendoComboBox").dataSource._data.length); i++) {
                    var val = $('#txt_pro_name').data('kendoComboBox').dataSource._data[i].dependent;
                    // alert(val);
                    var row = $($('#txt_pro_name').data('kendoComboBox').list.find('li')[i]);
                    // alert(row);
                    if (val == category) {
                        row.css('display', 'block');
                        $('#txt_pro_name').data("kendoComboBox").enable(true);
                    }
                    else {
                        row.css('display', 'none')
                    }
                }
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }


</script>


<style>
    .k-widget.k-tooltip {
        background-color: #ffe79e;
        color: #6b5100;
    }

    span.k-tooltip {
        white-space: pre-line;
    }
</style>
