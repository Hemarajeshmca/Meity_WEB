@{
    ViewBag.Form = "Production Transaction";
    Layout = "~/Views/Shared/FormViewLayout1.cshtml";
}

<form id="productadj_form" class="form-horizontal">
    <div class="panel panel-default">
        <div class="panel-body" style="padding-top:6px;padding-bottom:2px">
            <div class="row" style="padding-bottom:15px">
                <div class="col-xs-4" style="display:none">
                    <div class=" form-group">
                        <label for="txt_stage_id" class=" col-sm-5 control-label ">Stage Document Id</label>
                        <div class=" col-sm-6">
                            <input type="text" id="txt_stage_id" name="In_stage_document_id" class="form-control" maxlength="50">
                            <input type="hidden" id="txt_pro_tran_rowid" name="IOU_pro_tran_rowid">
                            <input type="hidden" id="txtagg_code">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="cmb_fg_code" id="fg_code" class=" col-sm-5 control-label">FG Code</label>
                        <div class=" col-sm-6">
                            <input type="text" id="cmb_fg_code" name="IOU_fg_code" class="form-control" onchange="fg_search()" readonly>
                            @*<input type="text" id="cmb_fg_code" name="fg_code" data-role="filtercombo" style="width:100%">*@
                        </div>
                        <div>
                            <a class="HelpWindow fa fa-search fa-lg" role="button" id="pay_help1" data-toggle="modal" href="/HelpFilter/HelpFilter" hdrtitle="FG Search" searchid="PW08" data-target="#HelpModal" onclick=transfer(this,"form","","form_control"); title="Search" style="font-size: 19px; "></a>
                        </div>
                        @*<div>
        <a class="HelpWindow fa fa-search fa-lg" role="button" id="pay_help2" data-toggle="modal" href="/HelpFilter/HelpFilter" hdrtitle="Service Recipt Search" searchid="PW10" data-target="#HelpModal" onclick=transfer(this,"form","","form_control"); title="Search" style="font-size: 19px; "></a>
    </div>*@
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class=" form-group">
                        <label for="tran_type" class="col-sm-5 control-label">Transaction Type</label>
                        <div class=" col-sm-4">
                            <input type="radio" id="rdo_procurement" name="In_tran_type" checked="checked" onclick="changing()" />Procurement
                        </div>
                        <div class=" col-sm-3">
                            <input type="radio" id="rdo_service" name="In_tran_type" onclick="changing()" />Service
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="cmb_service_code" id="service_code" class=" col-sm-5 control-label">Service Code</label>
                        <div class=" col-sm-6">
                            <input type="text" id="cmb_service_code" class="form-control" name="In_status_code" onchange="Service_search()" disabled>
                        </div>
                        <div>
                            <a class="HelpWindow fa fa-search fa-lg" role="button" id="pay_help2" data-toggle="modal" href="/HelpFilter/HelpFilter" hdrtitle="Service Receipt Search" searchid="PW10" data-target="#HelpModal" onclick=transfer(this,"form","","form_control"); title="Search" style="font-size: 19px; "></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" id="product_stage" style="padding-bottom:15px">
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txt_fg_name" id="fg_name" class=" col-sm-5 control-label ">FG Name</label>
                        <div class=" col-sm-6">
                            <input type="text" id="txt_fg_name" name="" class="form-control" maxlength="50" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="cmb_produc_stage" id="product_stage" class="col-sm-5 control-label">Production Stage</label>
                        <div class=" col-sm-6">
                            <input type="text" id="cmb_produc_stage" name="In_production_stage_code" class="form-control" maxlength="50">
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="service_type" id="lbl_service_type" class=" col-sm-5 control-label ">Service Type</label>
                        <div class=" col-sm-6">
                            <input type="text" id="service_type" class="form-control" maxlength="50" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" style="padding-bottom:15px">
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txtfrom_date" class=" col-sm-5 control-label">Stage Start DateTime </label>
                        <div class=" col-sm-6">
                            <input id="txtfrom_date" class="attrDateTime" data-role="datetimepicker" style="width: 100%;" name="In_stage_start_datetime" maxlength="10" />
                            @*<input data-role='datepicker' class="cusDate" onkeypress="return date_validate(event)" id="txtfrom_date" data-checkdate-msg="Enter Valid Date" name="stage_start_datetime" style="width:120%;font-size:85%" />*@
                            <span data-for='valid' class='k-invalid-msg'></span>
                            @*<input class="cusDate" type="date" data-role='datepicker' onkeypress="return date_validate(event)" id="stage_start_date" data-checkdate-msg="Enter Valid Date" name="stage_start_datetime" style="width:100%" />
                                <span data-for='valid' class='k-invalid-msg'></span>*@
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group">
                        <label for="txtto_date" class=" col-sm-5 control-label">Stage End DateTime </label>
                        <div class=" col-sm-6">
                            <input id="txtto_date" class="attrDateTime" data-role="datetimepicker" style="width: 100%;" name="In_stage_end_datetime" maxlength="10" />
                            @*<input data-role='datepicker' class="cusDate" onkeypress="return date_validate(event)" id="txtto_date" data-checkdate-msg="Enter Valid Date" name="stage_end_datetime" style="width:120%;font-size:85%" />*@
                            <span data-for='valid' class='k-invalid-msg'></span>
                            @*<input class="cusDate" type="date" data-role='datepicker' onkeypress="return date_validate(event)" id="stage_end_date" data-checkdate-msg="Enter Valid Date" name="valid_until" style="width:100%" />
                                <span data-for='valid' class='k-invalid-msg'></span>*@
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class=" form-group" style="display:none;">
                        <label for="adj_date" class=" col-sm-5 control-label">Stage Start Time </label>
                        <div class=" col-sm-6">
                            <input class="cusDate" type="date" data-role='datepicker' onkeypress="return date_validate(event)" id="In_stage_start_time" data-checkdate-msg="Enter Valid Date" name="" style="width:100%" />
                            <span data-for='valid' class='k-invalid-msg'></span>
                        </div>
                    </div>
                </div>
                <div class=" form-group">
                    <button id="btnclear" title="" data-placement="top" data-toggle="tooltip" style="float:right ;margin-bottom:5px;margin-right: 27px;" type="button" class="btn btn-info" data-original-title="">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </button>
                </div>
            </div>

            <div class="row" style="padding-bottom:15px">
                <div class="col-xs-4">
                    <div class=" form-group" style="display:none;">
                        <label for=" adj_date" class=" col-sm-5 control-label">
                            Stage End Time
                        </label>
                        <div class=" col-sm-6">
                            <input class="cusDate" type="date" data-role='datepicker' onkeypress="return date_validate(event)" id="In_stage_end_time" data-checkdate-msg="Enter Valid Date" name="valid_until" style="width:100%" />
                            <span data-for='valid' class='k-invalid-msg'></span>
                        </div>
                        </div>
                </div>
               
                    <div class="col-sm-4" style="display:none">
                        <div class="form-group">
                            <label for="txt_stage_rowid" class="col-sm-5 control-label ">Stage RowId</label>
                            <div class="col-sm-6">
                                <input type="text" id="txt_stage_rowid" name="In_stage_rowid" class="form-control" data-toggle="tooltip" data-placement="bottom" placeholder="">
                            </div>
                        </div>
                    </div>
                    @*<div class="col-sm-4" style="display:none">
                <div class="form-group">
                    <label for="status_code" class="col-sm-5 control-label ">status_code</label>
                    <div class="col-sm-7">
                        <input type="text" id="status_code" name="status_code" class="form-control" maxlength="50" readonly>
                    </div>
                </div>
            </div>*@
                    <div class="col-sm-6">
                        <div class="form-group" style="display:none;">
                            <label for="txtMode" class="col-sm-5 control-label">Mode</label>
                            <div class="col-sm-4">
                                <input type="text" id="txtMode" name="In_mode_flag" class="form-control" maxlength="10">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group" style="display:none;">
                            <label for="row_timestamp" class="col-sm-5 control-label">Timestamp:</label>
                            <div class="col-sm-4">
                                <input type="text" id="txt_row_timestamp" name="In_row_timestamp" class="form-control" maxlength="10">
                            </div>
                        </div>
                    </div>
                </div>

            <div class="row" style="padding-bottom:15px">
                <div class="col-xs-12">
                    <div id="gd_production">
                        <div id="pro_tran_grid">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script src="~/API_Scripts/UmoldITWebAPIProxy.js"></script>
<script src="~/CommonScripts/HelpFile.js"></script>
<script src="~/CommonScripts/Common_func.js"></script>

<script>
    click_act_name = "ProductionTransactionStageList";
    click_ctrl_name = "PAWHSProductionTransaction";
    form_list_url = '../' + click_ctrl_name + '/' + click_act_name;
</script>
<script>
    $(document).ready(function () {

        $("#hide_div").hide();
        kendodate_format();
        $("#bottom_menus").hide();
        $(".file_attach").attr("hdrtitle", "HSN");
        $(".notes").attr("hdrtitle", "HSN");
        $("#lblForm_menuid").text("PRODTRANS");

        $("#pay_help2").hide();
        $("#lbl_service_type").hide();
        $("#service_type").hide();
        grid_product([]);

        Form_validate_Name = $('form.form-horizontal').attr('id');
        var container = $("#productadj_form");

        Screen_Id = "PRODTRANS";
        permission = sec_Permission(Screen_Id);
        $("#btnclear").click(function () {
            window.location = "../PAWHSProductionTransaction/TransactionStageForm";

        });
        $("#txtfrom_date").kendoDateTimePicker({
            value: new Date(),
           format: "MM/dd/yyyy hh:mm tt",
            dateInput: true
        });
        $("#txtto_date").kendoDateTimePicker({
            value: new Date(),
            format: "MM/dd/yyyy hh:mm tt",
            dateInput: true
        });
        load_master_code();
        $(".k-popup").css("overflow", "auto");
        var org_id = getlocalStorage('org_id');
        $('#txtagg_code').val(org_id);
        if (getlocalStorage('btn_clk_val') == "Create") {
            $('#divCreate #review').hide();
            $("#txtMode").val("I");
            $("#bottom_menus").hide();
            $("#DocStat").val("New");
        }
        else if ( getlocalStorage('btn_clk_val') == "Edit") {
            $('#divEdit #reviewEd').hide(); $('#divEdit #deactivate').hide();
            $("#btnclear").hide();
            $("#rdo_procurement").attr("disabled", true);
            $("#rdo_service").attr("disabled", true);
            if (getlocalStorage("ls_pageList") != undefined) {
                var data = getlocalStorage("ls_pageList");
                var formval = form_Serialize("productadj_form");
                var obj_val = JSON.parse(formval);
                obj_val.pro_tran_rowid = data.Out_pro_tran_rowid;
                obj_val.fg_code = data.Out_fg_code;
                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                var Context = data.context;
                $.ajax({
                    type: "POST",
                    data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, pro_tran_rowid: Context.Header.pro_tran_rowid, fg_code: Context.Header.fg_code }),
                    url: "/PAWHSProductionTransaction/PAWHSProductionTransactionfetch",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        debugger;
                        if (response.context != null) {
                            generate_productrans_header(response.context.Header)
                            generate_productrans_list(response.context.List)
                        }
                        else {

                        }
                    },
                    error: function (er) {
                        alert(er)
                        console.log(er)
                    }
                });
                $("#txtMode").val("U");
                fg_search();
            }
        }
        else if ( getlocalStorage('btn_clk_val') == "View") {
            $('#divEdit #reviewEd').hide(); $('#divEdit #deactivate').hide();
            $("#btnclear").hide();
            if (getlocalStorage("ls_pageList") != undefined) {
                var data = getlocalStorage("ls_pageList");
                var formval = form_Serialize("productadj_form");
                var obj_val = JSON.parse(formval);
                obj_val.pro_tran_rowid = data.Out_pro_tran_rowid;
                obj_val.fg_code = data.Out_fg_code;
                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                var Context = data.context;
                $.ajax({
                    type: "POST",
                    data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, pro_tran_rowid: Context.Header.pro_tran_rowid, fg_code: Context.Header.fg_code }),
                    url: "/PAWHSProductionTransaction/PAWHSProductionTransactionfetch",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        debugger;
                        if (response.context != null) {
                            generate_productrans_header(response.context.Header)
                            generate_productrans_list(response.context.List)
                        }
                        else {

                        }
                    },
                    error: function (er) {
                        alert(er)
                        console.log(er)
                    }
                });
                $("#txtMode").val("U");
                fg_search();
            }
        }
     
       

        kendo.init(container);
        container.kendoValidator({
        });
       
      
        $('#HelpModal').on('hide.bs.modal', function (e) {
            if ($("#cmb_fg_code").val() != "") {
                fg_search();
            }
        });
    });

    function load_master_code() {
        try {
            debugger;
            var data = {};
            var context = WebAPIProxy.getContext();
            data.userId = context.userId
            data.orgnId = context.orgnId
            data.locnId = context.locnId
            data.localeId = context.localeId
            data.screen_Id = "PRODTRANS";
            var tab_values = ajaxcall_param("/Home/screenId_mastercodelist", JSON.stringify(data));
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>
<script>
    function grid_product(data) {
        try {
            $("#pro_tran_grid").kendoGrid({
                dataSource: {
                    data: data,
                    schema: {
                        model: {
                            fields: {

                                In_pro_tran_dtl_rowid: { type: "string" },
                                In_input_or_output: { type: "string", editable: false },
                                In_item: { type: "string", editable: false },
                                In_uom: { type: "string", editable: false },
                                In_qty: { type: "string" },
                                In_status_code: { type: "string" },
                                In_mode_flag: { type: "string", defaultValue: "I" }
                            }
                        }
                    }
                },

                height: 300,
                groupable: false,
                dataBinding: setDefaultValues,

                dataBound: function (e) {
                    resultData = e.sender._data;
                    var rows = $('#pro_tran_grid').data('kendoGrid').tbody.children();
                    setColor(rows, resultData);
                },
                sortable: true,
                selectable: true,
                navigatable: true,
                columns: [
                    {
                        field: "In_pro_tran_dtl_rowid",
                        title: "pro_tran_dtl_rowid",
                        width: 1,
                        hidden: true,
                    },
                 {
                     field: "In_input_or_output",
                     title: "Input/Ouput",
                     editor: function (container, options) {
                         combo_editor_man(container, "cmb_" + options.field, eval(options.field + "_list"), options.field, "", "grid")
                     },
                     width: 100,

                 },

                 {
                     field: "In_item",
                     title: "item",
                     editor: '<div class="input-group input-group-sm"><input type="text" readonly name="product_category" maxlength="10" style="width:100px;color:black"  onkeypress="return speical_char(event)" data-bind="value:hsn_code"/><span class="input-group-btn" style="padding-right: 90px;"><a class="HelpWindow fa fa-search fa-lg" data-toggle="modal" href="/HelpFilter/HelpFilter" hdrtitle="Details" searchid="S03" data-target="#HelpModal" onclick=transfer(this,"grid","grid_prodc_adj","GridProcAdj") title="Search" style="font-size: 15px; padding-left: 10px;"></a> </span> </div>',
                     width: 140,

                 },

                 {
                     field: "In_uom",
                     title: "UOM",
                     width: 100,

                 },
                 {
                     field: "In_qty",
                     title: "Quantity",
                     attributes: { style: "text-align:right;" },
                     editor: function (container, options) {
                         numeric_editor(container, options.field, '50', '0');

                     },
                     width: 100,
                 },
                  {
                      field: "In_status_code",
                      title: "status_code",
                      width: 1,
                      hidden: true,
                  },
                   {
                       field: "In_status_desc",
                       title: "Status",
                       width: 1,
                       hidden: true,
                   },
                {
                    field: "In_mode_flag",
                    title: "Mode",
                    hidden: true
                }],
                editable: true
            });
        }
        catch (err) {
            alert(err);
        }
    }
</script>

<script>


    var validate = false;
    function Validation() {
        if ($("#cmb_fg_code").val() == "") {
            kendoAlert("FG Code Cannot Be Blank. Please Fill the FG Code Field");
            return 0;
        }
        if ($(document.getElementById("rdo_procurement")).checked == true) {
            if ($("#cmb_service_code").val() == "") {
                kendoAlert("Service Code Cannot Be Blank. Please Fill the Service Code Field");
                return 0;
            }
        }
        if ($("#txt_fg_name").val() == "") {
            kendoAlert("FG Name Cannot Be Blank. Please Fill the FG Name Field");
            return 0;
        }
        if ($("#cmb_produc_stage").val() == "") {
            kendoAlert("Production Stage Cannot Be Blank. Please Fill the Production Stage Field");
            return 0;
        }
        if ($("#txtfrom_date").val() == "") {
            kendoAlert("Stage Start DateTime Cannot Be Blank. Please Fill the Stage Start DateTime Field");
            return 0;
        }
        if ($("#txtto_date").val() == "") {
            kendoAlert("Stage End DateTime Cannot Be Blank. Please Fill the Stage End DateTime Field");
            return 0;
        }
        else {
            validate = true;
        }
    }
    function timeConvertor(tme) {
        var PM = tme.match('PM') ? true : false

        tme = tme.split(':')
        var min = tme[1]

        if (PM) {
            var hour = 12 + parseInt(tme[0], 10)
            var sec = tme[2].replace('PM', '')
        } else {
            var hour = tme[0]
            var sec = tme[2].replace('AM', '')
        }
        return (hour + ':' + min + ':' + sec)
    }
    function get_DBdatefarmat(date) {
        var datesplit = date.split("/");
        var time = datesplit[2].split(" ");
        var tme = time[1]+ ":" +"00" + time[2];       
        var d = timeConvertor(tme);      
        return time[0] + "-" + datesplit[0] + "-" + datesplit[1] + "T" + d ;
    }
    function save() {
        debugger;
        try {
            Validation();
            if (validate == true) {
                if ($("#txtMode").val() == "") {
                    $("#txtMode").val('I');
                }
                if ($("#txtMode").val() == "S") {
                    $("#txtMode").val('U');
                }
                if ($("#txtMode").val() == "U") {
                    $("#txtMode").val('I');
                }
                if ($("#txt_pro_tran_rowid").val() == "") {
                    $("#txt_pro_tran_rowid").val('0');
                }
                if ($("#txt_stage_id").val() == "") {
                    $("#txt_stage_id").val('0');
                }
                $("#cmb_service_code").removeAttr("readonly");
                var formval = form_Serialize("productadj_form");
                var obj_val = JSON.parse(formval);
                
                obj_val.In_stage_start_datetime = get_DBdatefarmat(obj_val.In_stage_start_datetime);
                obj_val.In_stage_end_datetime = get_DBdatefarmat(obj_val.In_stage_end_datetime);
                if ($("#rdo_procurement").is(":checked")) {
                    obj_val.In_tran_type = "Procurement";
                    obj_val.In_status_code = "A";
                }
                if ($("#rdo_service").is(":checked")) {
                    obj_val.In_tran_type = "Service";
                }
                $("#cmb_service_code").attr("readonly", true);
                var grid_val = JSON.stringify($("#pro_tran_grid").data().kendoGrid._data);
                var Bind = {};
                Bind = grid_val;
                var result = JSON.parse(Bind);
                $.each(result, function (index, value) {
                    var row_id = value.In_pro_tran_dtl_rowid;
                    if (row_id == undefined || row_id == '') {
                        result[index].In_pro_tran_dtl_rowid = "0";
                    }
                    var status_code = value.In_status_code;
                    if (status_code == undefined || status_code == '') {
                        result[index].In_status_code = obj_val.In_status_code;
                    }
                    var mode_flag = value.In_mode_flag;
                    if (mode_flag == undefined || mode_flag == '') {
                        result[index].In_mode_flag = "I";
                    }
                    var mmode = result[index].mode_flag;
                    if (mmode == "S") {
                        result[index].In_mode_flag = "U";
                    }
                });
                var obj_grid_val = result;

                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                data.context.List = obj_grid_val;
                var Context = data.context;
                $.ajax({
                    type: "POST",
                    data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, Header: Context.Header, List: Context.List }),
                    url: "/PAWHSProductionTransaction/PAWHSProductionTransactionSave",
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        console.log(response)
                        var Res = JSON.parse(response);
                        if (Res.context != null) {
                            var mode = $("#txtMode").val();
                            if (mode == "I") {
                                kendoAlert("Production Transaction saved successfully");
                                get_productiontransaction_details(responseJSON.context.Header);
                            }
                            else if (mode == "D") {
                                kendoAlert("Production Transaction inactivate successfully");
                                get_productiontransaction_details(responseJSON.context.Header);

                            }
                            else {
                                kendoAlert("Production Transaction Updated successfully");
                                // retrieve_productiontransaction_list();
                                get_productiontransaction_details(responseJSON.context.Header);
                            }
                        }
                        else {
                            kendoAlert(Res.ApplicationException.errorDescription);
                        }
                    },
                    error: function (er) {
                        alert(er)
                        console.log(er)
                    }

                });
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
           
        }
    }

    function fg_search() {
        try {
            //if ($("#rdo_procurement").is(":checked")) {
            var formval = form_Serialize("productadj_form");
            var obj_val = JSON.parse(formval);
            obj_val.fg_code = $("#cmb_fg_code").val();
            var data = {};
            data.context = WebAPIProxy.getContext();
            data.context.Header = obj_val;
            var Context = data.context;
            $.ajax({
                type: "POST",
                data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, fg_code: Context.Header.fg_code }),
                url: "/PAWHSStageItem/PAWHSProductionStageitemfetch",
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    debugger;
                    if (response.context != null) {
                        GenerateStageHeader(response.context);
                    }
                    else {

                    }
                },
                error: function (er) {
                    alert(er)
                    console.log(er)
                }
            });
            //}
            //if ($("#rdo_service").is(":checked")) {
            //    //Service_search();
            //}
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function Service_search() {
        try {
            var data = getlocalStorage("ls_pageList");
            var formval = form_Serialize("productadj_form");
            var obj_val = JSON.parse(formval);
            obj_val.fg_code = $("#cmb_fg_code").val();
            obj_val.stage_rowid = 0;

            var data = {};
            data.context = WebAPIProxy.getContext();
            data.context.Header = obj_val;
            var Context = data.context;
            $.ajax({
                type: "POST",
                data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, stage_rowid: Context.Header.stage_rowid, fg_code: Context.Header.fg_code }),
                url: "/PAWHSStageItem/PAWHSProductionStagefetch",
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    debugger;
                    if (response.context != null) {
                        generate_StageItemDefinition(response.context.Stage);
                    }
                    else {

                    }
                },
                error: function (er) {
                    alert(er)
                    console.log(er)
                }
            });
            $("#txtMode").val("U");
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function GenerateStageHeader(res) {

        $("#txtfg_code").val(res.Header.IOU_fg_code);
        var itemArr = [];
        for (var i = 0 ; i < res.Stage.length; i++) {
            var list = {};
            //list.code = res.Stage[i].input_output_code;
            //list.description = res.Stage[i].input_output_desc;
            list.id = res.Stage[i].In_stage_rowid
            list.code = res.Stage[i].In_stage_code;
            list.desc = res.Stage[i].In_stage_desc;
            itemArr.push(list);
        }
        filter_combobox("cmb_produc_stage", itemArr);
    }

    $("#cmb_produc_stage").change(function () {
        //$("#txtMode").val("U");
        var object = $("#cmb_produc_stage").data('kendoComboBox').dataItem()
        $("#txt_stage_rowid").val(object.id);

        var data = getlocalStorage("ls_pageList");
        var formval = form_Serialize("productadj_form");
        var obj_val = JSON.parse(formval);
        obj_val.fg_code = $("#cmb_fg_code").val();
        obj_val.stage_rowid = object.id;

        var data = {};
        data.context = WebAPIProxy.getContext();
        data.context.Header = obj_val;
        var Context = data.context;
        $.ajax({
            type: "POST",
            data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, stage_rowid: Context.Header.stage_rowid, fg_code: Context.Header.fg_code }),
            url: "/PAWHSStageItem/PAWHSProductionStagefetch",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (response) {
                debugger;
                if (response.context != null) {                   
                    generate_StageItemDefinition(response.context.Stage);
                }
                else {

                }
            },
            error: function (er) {
                alert(er)
                console.log(er)
            }
        });
        $("#txtMode").val("U");
    });

    function generate_productrans_header(res) {
        if (res != null) {
            $("#txt_stage_id").val(res.In_stage_document_id);
            $("#txt_stage_id").attr("readonly", "");
            $("#cmb_produc_stage").val(res.In_production_stage_code);
            $("#txtfrom_date").val(res.In_stage_start_datetime);
            $("#txtto_date").val(res.In_stage_end_datetime);
            $("#cmb_fg_code").val(res.IOU_fg_code);
            $("#txt_fg_name").val(res.In_status_code);
            $("#txtMode").val(res.In_mode_flag);
            $("#DocStat").val("Active");
            //if (res.tran_type = 'Procurement') {
            //    $("#rdo_procurement").attr("checked", true);
            //    $("#rdo_service").attr("checked", false);
            //} else {
            //    $("#rdo_procurement").attr("checked", false);
            //    $("#rdo_service").attr("checked", true);
            //}
            if (res.stage_document_id != '') {
                $('#cmb_produc_stage').attr("readonly", true);
                $("#cmb_fg_code").attr("readonly", true);
                $("#pay_help1").hide();
                $("#txtfrom_date").attr("readonly", true);
                $("#txtto_date").attr("readonly", true);
            }
        }
    }

    function generate_StageItemDefinition(res) {
        grid_product([]);
        $("#g_tx_div").empty();
        $("#g_tx_div").append("<div id='pro_tran_grid'></div>");
        var grid = $("#pro_tran_grid").data("kendoGrid");
        if (grid) {
            var dataSource_Tax = grid.dataSource;
            for (var i = res.length - 1; i >= 0; i--) {
                dataSource_Tax.insert(
                    {
                        In_input_or_output: res[i].In_input_output_code,
                        In_item: res[i].In_item_desc,
                        In_uom: res[i].In_uom,
                        In_qty: 0,
                        In_mode_flag: res[i].In_mode_flag
                    });
            }
        }
    }
</script>
<script>
    function changing() {
        if ($("#rdo_procurement").is(":checked")) {
            ClearValue();
            //$("#cmb_service_code").hide();
            //$("#service_code").hide();
            $("#cmb_service_code").attr("disabled", true);
            $("#cmb_service_code").val("");
            $("#pay_help2").hide();
            $("#lbl_service_type").hide();
            $("#service_type").hide();
        }
        if ($("#rdo_service").is(":checked")) {
            ClearValue();
            $("#lbl_service_type").show();
            $("#service_type").show();
            //$("#pay_help2").show();
            //$("#cmb_service_code").show();
            //$("#service_code").show();
            $("#cmb_service_code").removeAttr("disabled");
            $("#cmb_service_code").attr("readonly", true);
            $("#pay_help2").show();
        }
    }

    function ClearValue() {
        var data = [];
        grid_product(data);
        $("#cmb_fg_code").val('');
        $("#txt_fg_name").val('');
        $("#stage_start_datetime").val('');
        $("#stage_end_datetime").val('');
        filter_combobox("cmb_produc_stage", "");
    }

    function get_productiontransaction_details(res) {
        try {
            var formval = form_Serialize("productadj_form");
            var obj_val = JSON.parse(formval);
            obj_val.pro_tran_rowid = data.IOU_pro_tran_rowid;
            obj_val.fg_code = data.IOU_fg_code;
            var data = {};
            data.context = WebAPIProxy.getContext();
            data.context.Header = obj_val;
            var Context = data.context;
            $.ajax({
                type: "POST",
                data: JSON.stringify({ userId: Context.userId, orgnId: Context.orgnId, locnId: Context.locnId, localeId: Context.localeId, pro_tran_rowid: Context.Header.pro_tran_rowid, fg_code: Context.Header.fg_code }),
                url: "/PAWHSProductionTransaction/PAWHSProductionTransactionfetch",
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    debugger;
                    if (response.context != null) {
                        generate_productrans_header(response.context.Header)
                        generate_productrans_list(response.context.List)
                    }
                    else {

                    }
                },
                error: function (er) {
                    alert(er)
                    console.log(er)
                }
            });
            //$("#txt_stage_id").val(res.stage_document_id);
            $("#txtMode").val("U");
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function generate_productrans_list(res) {
        try {
            if (res != null) {
                var data = changedataType(res);
                $("#gd_production").empty();
                $("#gd_production").append("<div id='pro_tran_grid'></div>");
                grid_product(data);
            }
            else {

                grid_product([]);
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function grid_control() {
        try {
            var control_Name = [];
            return control_Name;
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function form_control() {
        var control_Name = [
            { "dataCol": "fg_code", "controlId": "cmb_fg_code", "type": "Text" },
            { "dataCol": "fg_name", "controlId": "txt_fg_name", "type": "Text" },
            { "dataCol": "service_receipt_no", "controlId": "cmb_service_code", "type": "Text" },
            { "dataCol": "service_type", "controlId": "service_type", "type": "Text" },
        ];
        return control_Name;
    }

    function controlName() {
        try {
            var control_Name = [
            ];
            return control_Name
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function trans_input_data() {
        var trans_coll = [
            { "trasfer": "Yes", "dataCol": "agg_code", "controlId": "txtagg_code", "grid_id": "", "grid_row_col": "agg_code" }
             //{ "trasfer": "Yes", "dataCol": "fg_code", "controlId": "txt_fg_name", "grid_id": "", "grid_row_col": "fg_code" }, ,

        ]
        return trans_coll;
    }
</script>
<style>
    .k-grid-header th.k-header, .k-filter-row th {
        text-align: left;
    }

    .k-widget.k-tooltip {
        background-color: #ffe79e;
        color: #6b5100;
    }

    span.k-tooltip {
        white-space: pre-line;
    }
</style>


