<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>KANCHI | Log in</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!--Style Sheet-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="~/CSS/bootstrap.min.css" rel="stylesheet" />
    <link href="~/CSS/AdminLTE.min.css" rel="stylesheet" />
    <link href="~/CSS/kendo.common-material.min.css" rel="stylesheet" />
    <link href="~/CSS/kendo.material.min.css" rel="stylesheet" />
    <style>
        .btn-primary {
            background-color: #30749c;
            border-color: #30749c;
        }

            .btn-primary:hover,
            .btn-primary:active,
            .btn-primary.hover {
                background-color: #30749c;
            }

        input:required:invalid, input:focus:invalid {
            border: 1px solid #ff9980;
        }

        input:required:valid {
            border: 1px solid #99bbff;
        }

        select:required:invalid, select:focus:invalid {
            border: 1px solid #ff9980;
        }

        select:required:valid {
            border: 1px solid #99bbff;
        }

        span.k-tooltip {
            padding: 4px 17px !important;
            width: 190px !important;
        }

        .k-tooltip-validation .k-warning {
            margin-left: -17px;
        }
        .tacbox {
            display: block;
            padding: 1em;
            margin: 2em;
            border: 3px solid #ddd;
            background-color: #eee;
            max-width: 500px;
        }

        input {
            height: 2em;
            width: 2em;
            vertical-align: middle;
        }
    </style>
    <!--Scripts-->
    <script src="~/Scripts/jQuery-2.1.4.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/CommonScripts/Common_func.js"></script>
    <script src="~/CommonScripts/AjaxScript.js"></script>
    <script src="~/Scripts/kendo.all.min.js"></script>
    <script type="text/x-kendo-template" id="ok-confirmation">
        <div id="div">
            <div class="col-sm-3">
            </div>
            <div class="col-sm-6">
                <button class="ok k-button" onclick="con_close()">OK</button>
            </div>
            <div class="col-sm-3">
            </div>
        </div>
    </script>

    <script>
        window.kendoAlert = function (msg) {
            var win = $("<div />").kendoWindow({
                title: "Message",
                width: "350px",
                height: "130px",
                modal: true,
                draggable: false,
                resizable: false
            }).getKendoWindow();
            win.center().open();
            win.content(msg + "<br><br>" + $("#ok-confirmation").html()).center().open();
        };
        function con_close() {
            //  $(".k-i-close").click();
            $('.k-window').css('display', 'none');
            $('.k-overlay').css('display', 'none');
        }
    </script>
</head>
<body class="hold-transition login-page" style="background:url('/images/Login_BG2.jpg');background-repeat:no-repeat">

    <form id="login_form">
        <div class="wrapper">
            <!-- <footer class="main-footer" style="margin-left: 0px; border-top: 0px; background-color: #3c8dbc">
        <div class="pull-right hidden-xs">
            <img src="~/images/naf.png.jpg" alt="LOGO" style="margin-top:-10px">
        </div>
        <img id="scsLogo" src="~/images/logo-small_left.png" style="margin-top:-5px" />
    </footer>-->
            @*prema added for responsive view on 18 apr 2022*@
            @*<img style="width:100%" class="img-responsive" src="~/images/Meity-banner.jpg">*@

            <img style="width:100%" id="banners" class="img-responsive1">
            <div class="container-fluid">
                <div class="row" style="margin-top:4px;">
                    <div class="col-sm-4">
                        <img style="width:100%" class="img-responsive" src="~/images/kanchi-login-logos.jpg" />
                    </div>
                    <div class="col-sm-4">
                        <p style="text-align:justify;margin-top: 20px;font-size: 15px;line-height: 26px;">
                            An integrated digital platform, that caters to end-to-end agricultural
                            activities – Demand aggregation, cashless payments for inputs and outputs, loan management
                            (application for loans, disbursement of loans and repayment of loans), leasing of farm equipment,
                            produce aggregation and grading, connecting farmers and buyers, and so on
                        </p>
                    </div>
                    @*prema added for responsive view on 18 apr 2022*@
                    @*<div class="col-sm-4" style="border:1px solid #e2e2e2;padding:15px;border-radius:5px;width:32% !important;">*@
                <div class="col-sm-4" style="border:1px solid #e2e2e2;padding:15px;border-radius:5px;">
                    @using (Html.BeginForm())
                    {
                        <div class="form-group input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="txtUserId" class="form-control" type="text" name='username' placeholder="username" />
                        </div>

                        <div class="form-group input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                            <input id="txtPassword" class="form-control" type="password" name='password' placeholder="password" />
                        </div>
                        <div class="tacbox">
                            <input id="checkbox" type="checkbox" style="width: 18px;"/>
                            <label for="checkbox"> I agree with the <a href="#" onclick="open_terms()">Terms and Conditions</a>.</label>
                        </div>
                        @*<div class="checkbox">
                <label>
                    <input type="checkbox">
                    Remember me
                </label>
            </div>*@
                        <div class="form-group">
                            <center><button id="btnLogin" onclick="login()" type="button" style="background-color:#7d7d7d;color:white;" class="btn btn-def btn-block"> Login </button></center>
                        </div>
                        <div class="form-group text-center">
                            <a href="#" style="color:#0fadfd" onclick="fogetpws()">Forgot Password</a><br>
                        </div>
                    }
                </div>
                </div>
            </div>

            <footer class="main-footer" style="margin-left: 0px; border-top:0px;margin-top:4px; background:#ebebeb">
                <div class="pull-right hidden-xs">
                    <img src="~/images/fin-footer-logo.jpg" alt="LOGO" style="margin-top:0px">
                </div>
                <p style="text-align:left;font-size:15px;margin-top:4px">©2022 Fintantra Solutions (P) Ltd. All rights reserved.</p>
                @*<p style="text-align:center;font-size:15px;">© Copyright FFI. All Rights Reserved. Ver1.0.2</p>*@
            </footer>
        </div>
    </form>

    <script>
        function open_terms() {
            debugger;
            var url = "../Terms-Conditions.html";
            window.open(url, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top=100, bottom = 300, left=400, width=850, height=600");
        }

        //-Regarding for forget password--//
        $(document).ready(function () {
            var profile_name = sessionStorage.getItem('UserID');
            if (profile_name != "") {
                $("#txtUserId").val(profile_name);
            }

            //captcha();
        });
        var checkbox = document.getElementById("checkbox"),
            button = document.getElementById("btnLogin");
        button.disabled = true;
        checkbox.onclick = function () {
            if (checkbox.checked) {
                btnLogin.disabled = false;
            }
            else {
                btnLogin.disabled = true;
            }
        };
       
        $('#login_form').keydown(function (e) {
            var key = e.which;
            if (key == 13) {
                // As ASCII code for ENTER key is "13"
                $('button[type=button]').click();
                return false;
            } else {
                return true;
            }
        });

        function login() {
            debugger;
            var mandatory_check = true;
            if ($("#txtUserId").val() == "" && $("#txtPassword").val() == "") {
                kendoAlert("Enter User name and Password");
                mandatory_check = false;
            } else {
            if ($("#txtUserId").val() == "" || $("#txtUserId").val() == undefined) {
                kendoAlert("Enter User name");
                mandatory_check = false;
            }
            if ($("#txtPassword").val() == "") {
                kendoAlert("Enter Password");
                mandatory_check = false;
                }
            }
            if (mandatory_check == true) {
                generate_guival();
                debugger;
                console.log(txtuser_id);
                console.log($("#txtPassword").val());
                var txtuser_id = getlocalStorage('us_id');
                var validatable = $("#login_form").kendoValidator().data("kendoValidator");
                if (validatable.validate()) {
                    var data = {};
                    var loginvalue = "";
                    data.userId = $("#txtUserId").val().trim();
                    data.password = $("#txtPassword").val();
                    //var val = $("input[name='DbType']:checked").val();
                    //data.Dbtype = val;
                    //setlocalStorage('Db_type', val);
                    loginvalue = ajaxcall_param_login('/Login/Login', JSON.stringify(data));
                    loginvalue = JSON.parse(loginvalue);
                    if (loginvalue.sec_ques == "") {
                        debugger;
                        sessionStorage.setItem('User_name', txtuser_id);
                        sessionStorage.setItem('Sec_question', loginvalue.sec_ques);
                        setlocalStorage('User_Id_Value', txtuser_id);
                        setlocalStorage('org_id', "global");
                        setlocalStorage('loc_id', "all");
                        setlocalStorage('localeId', "en_US");
                        setlocalStorage('Db_type', loginvalue.instance)
                        window.location.href = "@Url.Action("ForgotPassword", "ForgotPassword")";
                        return false;
                    }
                    else {
                        var str = loginvalue.msg;
                        if (str == "sucess") {                           
                            crtloginTime();
                            setlocalStorage('User_Id_Value', txtuser_id);
                            setlocalStorage('role', loginvalue.role);
                            setlocalStorage('role_code', loginvalue.role_code);
                            var sec_permission = JSON.parse(loginvalue.sec_permission);
                            setlocalStorage('sec_permission', sec_permission);
                            setlocalStorage('org_code', loginvalue.org_code);
                            setlocalStorage('user_log_rowno', loginvalue.user_log_rowno);
                            setlocalStorage('Db_type', loginvalue.instance)
                            setlocalStorage('fpo_state_code', loginvalue.state_code)
                            setlocalStorage('fpo_state_desc', loginvalue.state_desc)
                            setlocalStorage('parent_code', loginvalue.parent_code)
                            setlocalStorage('orgn_level', loginvalue.orgn_level)
                            setlocalStorage('user', loginvalue.user)
                            setlocalStorage('usermail', loginvalue.usermail)
                            setlocalStorage('usercontact_no', loginvalue.usercontact_no)
                            setlocalStorage('loginhistoryrow_id', loginvalue.loginhistoryrow_id)
                            location.href = "../Home/Home";
                        }
                        else {
                            kendoAlert(loginvalue.msg);
                            return false;

                        }
                    }
                }
            }
        }

        function generate_guival() {
            debugger;
            var data = {};
            var gui_val = "";
            data.userId = $("#txtUserId").val().trim();
            gui_val = ajaxcall_param_login('/Login/generate_guivalue', JSON.stringify(data));
            @*$.ajax({
                type: "POST",
                url:'@Url.Action("generate_guivalue","Login")',
                data: '{userId:"' + $("#txtUserId").val()+'"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response != null) {
                        alert("Name : " + response.Name + ", Designation : " + response.Designation + ", Location :" + response.Location);

                    } else {
                        alert("Something went wrong");
                    }
                },
            });*@
            creatlocalStorage(gui_val);
            setlocalStorage('us_id', data.userId);
        }

        function fogetpws() {
            debugger;
            generate_guival();
            if ($("#txtUserId").val() != "") {
                var f_data = {};
                var f_loginvalue = "";
                var User_data = "";
                f_data.userId = $("#txtUserId").val().trim();
                var val = $("input[name='DbType']:checked").val();
                f_data.Dbtype = val;
                f_loginvalue = ajaxcall_param_login('/Login/getSecurityqus', JSON.stringify(f_data));
                User_data = JSON.parse(f_loginvalue);
                if (User_data.success == true) {
                    sessionStorage.setItem('Sec_question', User_data.result);
                    sessionStorage.setItem('User_name', f_data.userId);
                    setlocalStorage('User_Id_Value', f_data.userId);
                    setlocalStorage('org_id', "global");
                    setlocalStorage('loc_id', "all");
                    setlocalStorage('localeId', "en_US");

                    var url = '../ForgotPassword/ForgotPassword';
                    window.history.replaceState("", "", url);
                    $(location).attr('href', url);
                }
                else {
                    kendoAlert(User_data.result);
                }
            }
            else {
                kendoAlert("Please Enter your User Id");
            }
            // location.href = "../ForgotPassword/ForgotPassword";
        }

        function crtloginTime() {
            var date = new Date();
            var day = (date.getDate() + 1) > 9 ? (date.getDate() + 0) : "0" + (date.getDate() + 1);
            var month = (date.getMonth() + 1) > 9 ? (date.getMonth() + 1) : "0" + (date.getMonth() + 1);
            var hours = (date.getHours()) > 9 ? (date.getHours()) : "0" + (date.getHours());
            var minutes = (date.getMinutes()) > 9 ? (date.getMinutes()) : "0" + (date.getMinutes());
            var seconds = (date.getSeconds()) > 9 ? (date.getSeconds()) : "0" + (date.getSeconds());
            var dateString =
            day + "/" +
            month + "/" +
            date.getFullYear() + " " +
            hours + ":" +
            minutes + ":" +
            seconds;
            setlocalStorage('crtloginTime', dateString);
        }

    </script>
</body>
</html>
