@{
    ViewBag.Form = "My Bookings";
    Layout = "~/Views/Shared/FormViewLayout2.cshtml";
}

<form id="MybookingForm" class="form-horizontal">
    <div class="row">
        <section class="col-md-12">
            <div id="tab_list" class="col-md-12">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#Booking" id="" role="tab" data-toggle="tab">
                            Booking Details
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane fade active in" id="Booking">
                        <div class="panel panel-default">

                            <div class="panel-body" style="padding-top:6px;padding-bottom:2px">
                                <div class="row" style="padding-bottom:5px">
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtcust_code" class=" col-sm-5 control-label">Customer Code</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtcust_code" name="customer_code" class="form-control" maxlength="50" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtcust_name" class=" col-sm-5 control-label">Customer Name</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtcust_name" name="customer_name" class="form-control" maxlength="50" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtbkng_id" class=" col-sm-5 control-label">Booking ID</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtbkng_id" name="booking_no" class="form-control" maxlength="50" readonly style="width:120%">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class=" form-group">
                                            <label for="txt_equipment" class=" col-sm-5 control-label">Equipment</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txt_equipment" name="equipment_name" class="form-control" readonly style="width:120%">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="padding-bottom:5px">
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtbkng_date" class=" col-sm-5 control-label">Booking Date</label>
                                            <div class=" col-sm-6">
                                                <input class="cusDate" type="date" data-role='datepicker' onkeypress="return date_validate(event)" readonly id="txtbkng_date" data-checkdate-msg="Enter Valid Date" name="booking_date" style="width:100%" />
                                                <span data-for='valid' class='k-invalid-msg'></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="cmb_uom" class=" col-sm-5 control-label">UOM Type</label>
                                            <div class=" col-sm-6">
                                                <input id="cmb_uom" data-role="filtercombo" class="form-control" name="uom_type" style="width:100%">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtbkngfrom_date" class=" col-sm-5 control-label">Period From</label>
                                            <div class=" col-sm-6">
                                                <input type="date" onkeypress="return date_validate(event)" id="txtbkngfrom_date" data-checkdate-msg="Enter Valid Date" name="period_from" style="width:120%;font-size:85%" />
                                                <span data-for='valid' class='k-invalid-msg'></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtbkngto_date" class=" col-sm-5 control-label">Period To</label>
                                            <div class=" col-sm-6">
                                                <input type="date" onkeypress="return date_validate(event)" id="txtbkngto_date" data-checkdate-msg="Enter Valid Date" name="period_to" style="width:120%;font-size:85%" />
                                                <span data-for='valid' class='k-invalid-msg'></span>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row" style="padding-bottom:5px">
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txt_duration" class=" col-sm-5 control-label">Hour(s)/Day(s)</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txt_duration" name="duration" class="form-control" maxlength="8" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtbkng_rate" class=" col-sm-5 control-label">Rate</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtbkng_rate" name="rate" class="form-control" maxlength="8">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txt_transport" class=" col-sm-5 control-label">Transportation cost</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txt_transport" name="transportcost" class="form-control" maxlength="8" style="width:120%">

                                            </div>
                                            @*<input type="hidden" id="cmb_eqstatus" data-role="filtercombo" class="form-control" name="process_status" maxlength="50">*@
                                            <input type="hidden" id="booking_rowid" name="booking_rowid" />
                                            <input type="hidden" id="txtMode" name="mode_flag" value="I">
                                            <input type="hidden" id="status_code" name="status_code">
                                            <input type="hidden" id="process_status" name="process_status">
                                            <input type="hidden" id="Required_location_code" name="Required_location_code" />
                                            <input type="hidden" id="Required_location_desc" name="Required_location_desc">
                                            <input type="hidden" id="manfaturer_name_code" name="manfaturer_name_code">
                                            <input type="hidden" id="manfaturer_name_desc" name="manfaturer_name_desc">
                                            <input type="hidden" id="remarks" name="remarks" />
                                            <input type="hidden" id="esp_name" name="esp_name">

                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txt_others" class=" col-sm-5 control-label">Others</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txt_others" name="othercost" class="form-control" maxlength="8" style="width:120%">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="padding-bottom:5px">
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtnet_amt" class=" col-sm-5 control-label">Net Amount</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtnet_amt" name="net_amount" class="form-control" maxlength="8" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="cmb_eqstatus" class=" col-sm-5 control-label">Status</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txt_equipmentstatus" name="process_status_desc" value="Booking Initiate" class="form-control" maxlength="8">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class=" form-group">
                                            <label for="txtequ_num" class=" col-sm-5 control-label">Equipment No</label>
                                            <div class=" col-sm-6">
                                                <input type="text" id="txtequ_num" name="equipment_no" class="form-control" maxlength="8" readonly style="width:120%">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <div class="row">
        <div class="col-sm-12" id="default-example">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingTwo">
                    <h4 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" class="collapsed">
                            <i class="more-less glyphicon glyphicon-plus"></i>
                            Terms & Condition
                        </a>
                    </h4>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                    <div class="panel-body">
                        <div class="col-sm-12">
                            <div id="grid_terms_condition"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <section class="col-md-12">
            <div id="tab_list" class="col-md-12">
                <ul class="nav nav-tabs">
                    <li>
                        <a href="#History" id="" role="tab" data-toggle="tab">
                            History
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade active in" id="History">
                        <div class="panel panel-default">
                            <div class="panel-body" style="padding-bottom:5px">
                                <div class="row">
                                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                        <div class="col-sm-12" id="default-example">
                                            <div class="panel panel-default">
                                                <div class="panel-heading" role="tab" id="headingone">
                                                    <h4 class="panel-title">
                                                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseone" aria-expanded="true" aria-controls="collapseone">
                                                            <i class="more-less glyphicon glyphicon-plus"></i>
                                                            Booking Details
                                                        </a>
                                                    </h4>
                                                </div>
                                                <div id="collapseone" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingone">
                                                    <div class="panel-body">
                                                        <div class="col-sm-12">
                                                            <div id="grid_ESP"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12" id="default-example">
                                            <div class="panel panel-default">
                                                <div class="panel-heading" role="tab" id="headingThree">
                                                    <h4 class="panel-title">
                                                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree" class="collapsed">
                                                            <i class="more-less glyphicon glyphicon-plus"></i>
                                                            Terms & Conditions
                                                        </a>
                                                    </h4>
                                                </div>
                                                <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                                                    <div class="panel-body">
                                                        <div class="col-sm-12">
                                                            <div id="grid_terms_condition1"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</form>
<script src="~/API_Scripts/My_Booking_retrievebookingrate_APIClient.js"></script>
<script src="~/API_Scripts/My_Booking_retrieveMyBooking_APIClient.js"></script>
<script src="~/API_Scripts/My_Booking_retrieveMyBookingList_APIClient.js"></script>
<script src="~/API_Scripts/My_Booking_saveMyBooking_APIClient.js"></script>
<script src="~/API_Scripts/retrievebookingrate_Model.js"></script>
<script src="~/API_Scripts/retrieveMyBooking_Model.js"></script>
<script src="~/API_Scripts/retrieveMyBookingList_Model.js"></script>
<script src="~/API_Scripts/saveMyBooking_Model.js"></script>
<script src="~/API_Scripts/MyBooking.js"></script>
<script src="~/API_Scripts/UmoldITWebAPIProxy.js"></script>
<script src="~/CommonScripts/HelpFile.js"></script>
<script src="~/CommonScripts/Common_func.js"></script>

<script>
    click_act_name = "MyBookingsList";
    click_ctrl_name = "MyBookings";
    form_list_url = '../' + click_ctrl_name + '/' + click_act_name;
</script>
<script>
    $(document).ready(function () {
        kendodate_format();
        Form_validate_Name = $('form.form-horizontal').attr('id');
        var container = $("#MybookingForm");

        function startChange() {
            var startDate = start.value(),
            endDate = end.value();

            if (startDate) {
                startDate = new Date(startDate);
                startDate.setDate(startDate.getDate());
                //end.min(startDate);
            } else if (endDate) {
                //start.max(new Date(endDate));
            } else {
                endDate = new Date();
                //start.max(endDate);
                //end.min(endDate);
            }
            dt1 = new Date(startDate);
            dt2 = new Date(endDate);;
            duration(dt1, dt2);
        }
        $("#grid_terms_condition1").css("overflow", "auto")
        $("#grid_ESP").css("overflow", "auto")
        function endChange() {
            var endDate = end.value(),
            startDate = start.value();

            if (endDate) {
                endDate = new Date(endDate);
                endDate.setDate(endDate.getDate());
                //start.max(endDate);
            } else if (startDate) {
                // end.min(new Date(startDate));
            } else {
                endDate = new Date();
                //start.max(endDate);
                //end.min(endDate);
            }
            dt1 = new Date(startDate);
            dt2 = new Date(endDate);
            duration(dt1, dt2);
        }

        var today = kendo.date.today();

        var start = $("#txtbkngfrom_date").kendoDateTimePicker({
            value: today,
            change: startChange,
            format: "dd/MM/yyyy hh:mm tt"
        }).data("kendoDateTimePicker");

        var end = $("#txtbkngto_date").kendoDateTimePicker({
            value: today,
            change: endChange,
            format: "dd/MM/yyyy hh:mm tt"
        }).data("kendoDateTimePicker");

        //start.max(end.value());
        //end.min(start.value());

        $(".k-popup").css("overflow", "auto");

        function duration(date1, date2) {
            if ($("#cmb_uom").data("kendoComboBox").value() == "QCD_FL_PERDAY") {

                var millisecondsPerDay = 1000 * 60 * 60 * 24;

                var millisBetween = date2.getTime() - date1.getTime();
                var days = millisBetween / millisecondsPerDay;
                // Round down.
                var duration = (Math.floor(days) + 1);
                $("#txt_duration").val(duration);
                calculate_netamount(duration);
            }
            else {
                var diff = (date2.getTime() - date1.getTime()) / 1000;
                diff /= 60;
                var duration = (Math.abs(Math.round(diff))) / 60;
                $("#txt_duration").val(duration);
                calculate_netamount(duration);
            }
        }
        function calculate_netamount(duration) {
            if ($("#cmb_uom").data("kendoComboBox").value() == "QCD_FL_PERDAY") {
                var rate = parseFloat($("#txtbkng_rate").val())
                var netamount = parseFloat(duration * rate);
                $("#txtnet_amt").val(netamount);
            }
            else {
                var rate = parseFloat($("#txtbkng_rate").val());
                var netamount = parseFloat((duration) * rate);
                $("#txtnet_amt").val(netamount);
            }
        }
        $("#txtbkng_rate").change(function () {
            var rate1 = parseFloat($("#txtbkng_rate").val());
            var duration1 = parseFloat($("#txt_duration").val());
            var transport1 = parseFloat($("#txt_transport").val());
            var others1 = parseFloat($("#txt_others").val());
            var netamount1 = parseFloat(duration1 * rate1);
            var total1 = netamount1 + transport1 + others1;
            $("#txtnet_amt").val(total1);


        });


        kendo.init(container);
        container.kendoValidator({
        });
        Screen_Id = "FALMYBKNG";
        load_master_code();

        $("#bottom_menus").hide();
        $(".file_attach").attr("hdrtitle", "MyBooking");
        $(".notes").attr("hdrtitle", "MyBooking");
        $("#lblForm_menuid").text("FALMYBKNG");
        $("#divCreate").hide();
        $("#divEdit").hide();
        $("#divView").hide();
        $('#frmlayerdiv').hide();
        $('#divUserRole21').show();
        $("#divUserRole21 #reviewEd").hide();
        $("#divUserRole21 #start").hide();
        $("#divUserRole21 #btnApprove1").hide();
        $("#divUserRole21 #btnReject1").hide();
        grid_bookingHistory([]);
        gridterms1([]);
        var data1 = [];
        gridterms([]);


        var EQ_Status = "";
        $("#cmb_eqstatus").empty();
        EQ_Status = grid_comboScreen_mastercodes("QCD_FL_BKGSTAUS");
        filter_combobox("cmb_eqstatus", EQ_Status);

        var uom_type = "";
        $("#cmb_uom").empty();
        uom_type = grid_comboScreen_mastercodes("QCD_FL_EQUOMTYPE");
        filter_combobox("cmb_uom", uom_type);



        $('#txtbkng_rate').keypress(function (event) {
            var $this = $(this);
            if ((event.which != 46 || $this.val().indexOf('.') != -1) &&
               ((event.which < 48 || event.which > 57) &&
               (event.which != 0 && event.which != 8))) {
                event.preventDefault();
            }

            //var text = $(this).val();
            //if (text.indexOf('.') != -1) {
            //    setTimeout(function () {
            //        if ($this.val().substring($this.val().indexOf('.')).length > 6) {
            //            $this.val($this.val().substring(0, $this.val().indexOf('.') + 6));
            //        }
            //    }, 1);
            //    if ((text.indexOf('.') != -1) &&
            //   (text.substring(text.indexOf('.')).length > 2) &&
            //   (event.which != 0 && event.which != 8) &&
            //   ($(this)[0].selectionStart >= text.length - 2)) {
            //        event.preventDefault();
            //    }
            //}
            //else {
            //    if ($this.val().length > 2) {
            //        if (event.which != 46) {
            //            event.preventDefault();
            //        }
            //    }
            //}

        });

        $('#txtbkng_rate').bind("paste", function (e) {
            var text = e.originalEvent.clipboardData.getData('Text');
            if ($.isNumeric(text)) {
                if ((text.substring(text.indexOf('.')).length > 6) && (text.indexOf('.') > -1)) {
                    e.preventDefault();
                    $(this).val(text.substring(0, text.indexOf('.') + 6));
                }
            }
            else {
                e.preventDefault();
            }
        });
        $("#txtbkng_date").kendoDatePicker({
            max: new Date(),
            format: "dd/MM/yyyy"
        });


        //$("#txtbkngfrom_date").kendoDatePicker({
        //    max: new Date(),
        //    format: "dd/MM/yyyy"
        //});
        //$("#txtbkngto_date").kendoDatePicker({
        //    min: new Date(),
        //    format: "dd/MM/yyyy"
        //});

        var container = $("#txtbkng_date");
        kendo.init(container);
        container.kendoValidator({
            rules: {
                checkdate: function (input) {
                    if (input.attr("data-role") == "datepicker") {
                        var res = isDate(input.val());
                        return res;
                    }
                    else {
                        return true;
                    }
                }
            }
        });
        if (getlocalStorage('btn_clk_val') == "Create") {
            $('#divCreate #review').hide();
            $("#bottom_menus").hide();
            $("#status_code").val("A");
            $("#DocStat").val("New");

        }
        else if (getlocalStorage('btn_clk_val') == "View" || getlocalStorage('btn_clk_val') == "Edit") {
            if (getlocalStorage("ls_pageList") != undefined) {
                var data = getlocalStorage("ls_pageList");
                var formval = form_Serialize("MybookingForm");
                var obj_val = JSON.parse(formval);
                if (obj_val != undefined) {
                    obj_val.booking_rowid = data.booking_rowid;
                    $("#booking_rowid").val(data.booking_rowid);
                    $("#txtcommon_id").val(data.booking_rowid);
                    $("#txt_equipmentstatus").val(data.process_status_desc)
                    var data = {};
                    data.context = WebAPIProxy.getContext();
                    data.context.Header = obj_val;
                    retrieve_MyBooking_details(data);
                    $("#txtMode").val("U");
                    $("#div_Comments").show();
                    setlocalStorage('doc_no', $("#booking_rowid").val());
                    localStorage.docno = $("#booking_rowid").val();
                    setlocalStorage('doc_row_id', $("#booking_rowid").val());

                }
            }
        }

        $("#cmb_uom").change(function () {
            if (obj_val != undefined) {
                obj_val.uom_type = $("#cmb_uom").data("kendoComboBox").value() + "," + $("#txt_equipment").val() + "/" + $("#txtbkng_id").val();

                var data = {};
                data.context = WebAPIProxy.getContext();
                data.context.Header = obj_val;
                retrieve_MyBooking_Equipmentratedetails(data);

            }
        });
    });
</script>
<script>
    function load_master_code() {
        try {
            debugger;
            var data = {};
            var context = WebAPIProxy.getContext();
            data.userId = context.userId
            data.orgnId = context.orgnId
            data.locnId = context.locnId
            data.localeId = context.localeId
            data.screen_Id = "FALMYBKNG";
            var tab_values = ajaxcall_param("/Home/screenId_mastercodelist", JSON.stringify(data));
        }

        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
</script>
<script>
    //var data = [];
    function gridterms(data) {
        try {
            $("#grid_terms_condition").kendoGrid({
                dataSource: {
                    data: data,
                    schema: {
                        model: {
                            fields: {
                                sl_no: { type: "string" },
                                termsandconditions: { type: "string" },
                                status_desc: { type: "string" },
                                mode_flag: { type: "string" }

                            }
                        },

                    }
                },
                toolbar: "<a class='k-grid-add' id='btnSave' href=''><span class='fa fa-plus' style='color:Black'></span></a>",
                height: 240,
                groupable: false,
                dataBinding: setDefaultValues,
                dataBound: function (e) {
                    resultData = e.sender._data;
                    var rows = $('#grid_terms_condition').data('kendoGrid').tbody.children();
                    setColor(rows, resultData);
                },
                sortable: true,
                selectable: true,
                navigatable: true,
                columns: [{
                    command: [
             {
                 name: "Delete",
                 id: "Delete",
                 imageClass: "fa fa-close",
                 click: function (e) {
                     // e.preventDefault();
                     var grid = $("#grid_terms_condition").data("kendoGrid");
                     var dataItem = $("#grid_terms_condition").data("kendoGrid").dataItem($(e.target).closest("tr"));
                     DeleteWindowEvent(e, dataItem, grid);
                     e.stopImmediatePropagation()
                 }
             },
                    ], title: "Action", width: "15px",
                },
                    {
                        field: "termsandconditions_rowid",
                        title: "ID",
                        width: 100,
                        hidden: true

                    },
                      {
                          field: "sl_no",
                          title: "Sl.No",
                          width: 100,
                          editor: function (container, options) {
                              numeric_editor(container, options.field, '3', '0');
                          },

                      },
                      {
                          field: "termsandconditions",
                          title: "Terms & Conditions",
                          width: 100,
                      },
                      {
                          field: "status_desc",
                          title: "Status",
                          editor: function (container, options) {
                              combo_editor_man(container, "cmb_" + options.field, eval(options.field + "_list"), options.field, "status_code", "grid_terms_condition")
                          },
                          width: 100,
                      },

                {
                    field: "mode_flag",
                    title: "mode_flag",
                    hidden: true
                },
                {
                    field: "status_code",
                    title: "status_code",
                    hidden: true
                }],
                editable: true
            });
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    load_master_code();
    status_desc_list = grid_comboScreen_mastercodes("STATUS");


</script>
<script>

    function field_enable() {
        $("#txtequ_num").removeAttr("readonly");
        $("#txtequ_num").prop("disabled", false);
        $("#txtcust_code").removeAttr("readonly");
        $("#txtcust_code").prop("disabled", false);
        $("#txtcust_name").removeAttr("readonly");
        $("#txtcust_name").prop("disabled", false);
        $("#txtbkng_id").removeAttr("readonly");
        $("#txtbkng_id").prop("disabled", false);
        $("#txt_equipment").removeAttr("readonly");
        $("#txt_equipment").prop("disabled", false);
        $("#txtbkng_date").removeAttr("readonly");
        $("#txtbkng_date").prop("disabled", false);
        $("#cmb_uom").data("kendoComboBox").enable(true);
        $("#txtbkngfrom_date").removeAttr("readonly");
        $("#txtbkngfrom_date").prop("disabled", false);
        $("#txtbkngto_date").removeAttr("readonly");
        $("#txtbkngto_date").prop("disabled", false);
        $("#txtbkng_rate").removeAttr("readonly");
        $("#txtbkng_rate").prop("disabled", false);
        $("#txtnet_amt").removeAttr("readonly");
        $("#txtnet_amt").prop("disabled", false);
        $("#txt_equipmentstatus").removeAttr("readonly");
        $("#txt_equipmentstatus").prop("disabled", true);
        $("#txt_duration").removeAttr("readonly");
        $("#txt_duration").prop("disabled", false);
        $('#txtbkngfrom_date').data('kendoDateTimePicker').enable(true);
        $('#txtbkngto_date').data('kendoDateTimePicker').enable(true);
        $("#txt_transport").removeAttr("readonly");
        $("#txt_transport").prop("disabled", false);
        $("#txt_others").removeAttr("readonly");
        $("#txt_others").prop("disabled", false);

    }
    function field_disable() {
        $("#txtequ_num").attr("readonly");
        $("#txtequ_num").prop("disabled", true);
        $("#txtcust_code").attr("readonly");
        $("#txtcust_code").prop("disabled", true);
        $("#txtcust_name").attr("readonly");
        $("#txtcust_name").prop("disabled", true);
        $("#txtbkng_id").attr("readonly");
        $("#txtbkng_id").prop("disabled", true);
        $("#txt_equipment").attr("readonly");
        $("#txt_equipment").prop("disabled", true);
        $("#txtbkng_date").attr("readonly");
        $("#txtbkng_date").prop("disabled", true);
        $("#txt_duration").attr("readonly");
        $("#txt_duration").prop("disabled", true);
        $('#txtbkngfrom_date').data('kendoDateTimePicker').enable(false);
        $('#txtbkngto_date').data('kendoDateTimePicker').enable(false);
        $("#txt_transport").attr("readonly");
        $("#txt_transport").prop("disabled", true);
        $("#txt_others").attr("readonly");
        $("#txt_others").prop("disabled", true);
    }
    function save() {
        try {
            field_enable();

            if ($("#txtMode").val() == "S") {
                $("#txtMode").val('U');
            }
            if ($("#txt_transport").val() == "") {
                $("#txt_transport").val('0');
            }
            if ($("#txt_others").val() == "") {
                $("#txt_others").val('0');
            }
            var formval = form_Serialize("MybookingForm");
            var obj_val = JSON.parse(formval);
            if ($("#booking_rowid").val() == undefined || $("#booking_rowid").val() == "") {
                obj_val.booking_rowid = 0;
            }
            else {
                obj_val.booking_rowid = $("#booking_rowid").val();
            }

            if (obj_val.customer_code == undefined || obj_val.customer_code == "") {
                obj_val.customer_code = "0";
            }
            else {
                obj_val.customer_code = obj_val.customer_code;
            }

            if (obj_val.booking_no == undefined || obj_val.booking_no == "") {
                obj_val.booking_no = "0";
            }
            else {
                obj_val.booking_no = obj_val.booking_no;
            }
            if (obj_val.period_from == undefined || obj_val.period_from == "") {
                obj_val.period_from = "0";
            }
            else {
                obj_val.period_from = get_datefarmat(obj_val.period_from);
            }
            if (obj_val.period_to == undefined || obj_val.period_to == "") {
                obj_val.period_to = "0";
            }
            else {
                obj_val.period_to = get_datefarmat(obj_val.period_to);
            }
            var fdate = obj_val.period_from;
            var fdatearray = fdate.split(' ');

            if (obj_val.status_code == undefined) {
                obj_val.status_code = "A";
            }
            if (obj_val.row_timestamp == undefined) {
                obj_val.row_timestamp = "0";
            }

            var grid_val = JSON.stringify($("#grid_terms_condition").data().kendoGrid._data);
            var Bind = {};
            Bind = grid_val;
            var result = JSON.parse(Bind);
            $.each(result, function (index, value) {
                var row_id = value.termsandconditions_rowid;
                if (row_id == undefined || row_id == '') {
                    result[index].termsandconditions_rowid = "0";
                }
                else {
                    result[index].mode_flag = "S";
                }
                var mode = value.mode_flag;
                if (mode == "") {
                    result[index].mode_flag = "I";
                }
                if (mode == "S") {
                    result[index].mode_flag = "U";
                }

                result[index].booking_no = obj_val.booking_no;
            });
            var obj_grid_val = result;
            field_disable();
            var data_save = {};
            data_save.context = WebAPIProxy.getContext();
            data_save.context.Header = obj_val;
            data_save.context.Terms_and_Conditions = obj_grid_val;
            save_MyBooking_details(data_save);
        }
        catch (err) {
            field_disable();
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>
<script>
    function get_datefarmat(date) {
        if (date != "" || date != undefined) {
            var str1 = date;
            var str2 = "T";
            if (str1.indexOf(str2) != -1) {
                var d = date.split("T");
                var dateonly = d[0];
                var datesplit = dateonly.split("-");
                var dateformat = datesplit[0] + "/" + datesplit[1] + "/" + datesplit[2] + " " + d[1];
            }
            else {
                var d = date.split(" ");
                var dateonly = d[0];
                var datesplit = dateonly.split("/");
                var dateformat = datesplit[2] + "/" + datesplit[1] + "/" + datesplit[0] + " " + d[1];
            }
            return dateformat;
        }
    }

    function get_DBdatefarmat(date) {
        var datesplit = date.split("/");
        var time = datesplit[2].split(" ");
        return time[0] + "-" + datesplit[1] + "-" + datesplit[0] + "T" + time[1];
    }
    function generate_MyBookingrate_header(res) {
        if (res != null) {
            $("#txtbkng_rate").val(res.rate);
            var startDate = $('#txtbkngfrom_date').val();
            var endDate = $('#txtbkngto_date').val();
            var dt1;
            var dt2;
            var str1 = startDate;
            var sstr2 = endDate
            var str2 = "T";
            if (str1.indexOf(str2) != -1) {
                startDate = new Date(startDate);
                startDate.setDate(startDate.getDate());
            }
            else {
                dt1 = get_DBdatefarmat(startDate);
                startDate = new Date(dt1);
                startDate.setDate(startDate.getDate());
            }
            if (sstr2.indexOf(str2) != -1) {
                endDate = new Date(endDate);
                endDate.setDate(endDate.getDate());
            }
            else {
                dt2 = get_DBdatefarmat(endDate);

                endDate = new Date(dt2);
                endDate.setDate(endDate.getDate());
            }

            duration_fetch(startDate, endDate);
        }
    }
    function duration_fetch(date1, date2) {
        if ($("#cmb_uom").data("kendoComboBox").value() == "QCD_FL_PERDAY") {

            var millisecondsPerDay = 1000 * 60 * 60 * 24;

            var millisBetween = date2.getTime() - date1.getTime();
            var days = millisBetween / millisecondsPerDay;
            // Round down.
            var duration = Math.abs(Math.floor(days) + 1);
            $("#txt_duration").val(duration);
            netamount(duration);
        }
        else {
            var diff = (date2.getTime() - date1.getTime()) / 1000;
            diff /= 60;
            var duration = Math.abs(Math.round(diff)) / 60;
            $("#txt_duration").val(duration);
            netamount(duration);
        }
    }
    function netamount(duration) {
        if ($("#cmb_uom").data("kendoComboBox").value() == "QCD_FL_PERDAY") {
            var rate = parseFloat($("#txtbkng_rate").val())
            var netamount = parseInt(duration * rate);
            $("#txtnet_amt").val(netamount);
        }
        else {
            var rate = parseFloat($("#txtbkng_rate").val());
            var netamount = parseFloat((duration / 60) * rate);
            $("#txtnet_amt").val(netamount);
        }
    }


    function get_MyBooking_details(res) {
        var formval = form_Serialize("MybookingForm");
        var obj_val = JSON.parse(formval);
        if (obj_val != undefined) {
            obj_val.booking_rowid = res.booking_rowid;
            var data_res = {};
            data_res.context = WebAPIProxy.getContext();
            data_res.context.Header = obj_val;
            retrieve_MyBooking_details(data_res);
            if (obj_val.process_status == "QCD_FL_BKGINITIATE") {
                $("#divUserRole21 #reviewEd").attr("disabled", true);
                $("#divUserRole21 #btnReject1").attr("disabled", true);
            }
            if (obj_val.process_status == "QCD_FL_EQUPACCEPT") {
                $("#divUserRole21 #start").attr("disabled", true);
            }
            if (obj_val.process_status == "QCD_FL_CNFINITIATE") {
                $("#divUserRole21 #btnReject1").attr("disabled", true);
            }
            if (obj_val.process_status == "QCD_FL_BKGSERINIACCEPTED") {
                $("#divUserRole21 #btnApprove1").attr("disabled", true);
            }
            //if (obj_val.process_status == "QCD_FL_EQUPEND") {
            //    $("#divUserRole21 #btnApprove1").attr("disabled", true);
            //}
        }

    }

    function generate_MyBooking_termsandcondition(res) {
        try {
            if (res != null) {
                var data = changedataType(res);
                gridterms(data);
            }
            else {
                gridterms([]);
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function generate_MyBooking_bookinghistory(res) {
        try {
            if (res != null) {
                var data = changedataType(res);
                grid_bookingHistory(data);
            }
            else {
                grid_bookingHistory([]);
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function generate_MyBooking_termsandconditionhistory(res) {
        try {
            if (res != null) {
                var data = changedataType(res);
                gridterms1(data);
            }
            else {
                gridterms1([]);
            }
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

    function generate_MyBooking_header(res) {
        if (res != null) {

            $("#txtcust_code").val(res.customer_code);
            $("#txtcust_name").val(res.customer_name);
            $("#txtbkng_id").val(res.booking_no);
            $("#txt_equipment").val(res.equipment_name);
            $("#txtbkng_date").val(res.booking_date);
            $("#booking_rowid").val(res.booking_rowid);
            $("#txtbkngfrom_date").val(res.period_from);
            $("#txtbkngto_date").val(res.period_to);
            $("#txt_duration").val(res.duration);
            $("#txtbkng_rate").val(res.rate);
            $("#txt_equipmentstatus").val(res.process_status_desc);
            $("#process_status").val(res.process_status);
            $("#cmb_uom").data("kendoComboBox").value(res.uom_type);
            $("#txtnet_amt").val(res.net_amount);
            $("#mode_flag").val(res.mode_flag);
            $("#DocStat").val(res.status_desc);
            $("#txt_transport").val(res.transportcost);
            $("#txt_others").val(res.othercost);
            $("#txtequ_num").val(res.equipment_no);

            $("#status_code").val(res.status_code);
            var totalhours = $("#txt_duration").val();
            //calculate_netamount(totalhours)

            if (res.process_status == "QCD_FL_CNFINITIATE" || res.process_status == "QCD_FL_EQUPMOVED" ||
                res.process_status == "QCD_FL_SERCMPACK" || res.process_status == "QCD_FL_EQUPSTART" ||
                res.process_status == "QCD_FL_EQUPEND" || res.process_status == "QCD_FL_EQUPACCEPT" || res.process_status == "QCD_FL_INGEN" || res.process_status == "QCD_FL_BKGSERINIACCEPTED") {
                $("#txtcust_code").attr("readonly");
                $("#txtcust_code").prop("disabled", true);
                $("#txtcust_name").attr("readonly");
                $("#txtcust_name").prop("disabled", true);
                $("#txtbkng_id").attr("readonly");
                $("#txtbkng_id").prop("disabled", true);
                $("#txt_equipment").attr("readonly");
                $("#txt_equipment").prop("disabled", true);
                $("#txtbkng_date").attr("readonly");
                $("#txtbkng_date").prop("disabled", true);
                $("#cmb_uom").data("kendoComboBox").enable(false);
                $("#txtbkngfrom_date").attr("readonly");
                $("#txtbkngfrom_date").prop("disabled", true);
                $("#txtbkngto_date").attr("readonly");
                $("#txtbkngto_date").prop("disabled", true);
                $("#txtbkng_rate").attr("readonly");
                $("#txtbkng_rate").prop("disabled", true);
                $("#txtnet_amt").attr("readonly");
                $("#txtnet_amt").prop("disabled", true);
                $("#txt_equipmentstatus").attr("readonly");
                $("#txt_equipmentstatus").prop("disabled", true);
                $("#txt_duration").attr("readonly");
                $("#txt_duration").prop("disabled", true);
                $('#txtbkngfrom_date').data('kendoDateTimePicker').enable(false);
                $('#txtbkngto_date').data('kendoDateTimePicker').enable(false);
                $("#txt_transport").attr("readonly");
                $("#txt_transport").prop("disabled", true);
                $("#txt_others").attr("readonly");
                $("#txt_others").prop("disabled", true)
                $("#txtequ_num").attr("readonly");
                $("#txtequ_num").prop("disabled", true);
            }
            if (res.process_status == "QCD_FL_BKGINITIATE") {
                $("#divUserRole21 #reviewEd").show();
                $("#divUserRole21 #start").hide();
                $("#divUserRole21 #btnApprove1").hide();
                $("#divUserRole21 #btnReject1").show();
                $("#txt_transport").attr("readonly");
                $("#txt_transport").prop("disabled", true);
                $("#txt_others").attr("readonly");
                $("#txt_others").prop("disabled", true)
            }
            if (res.process_status == "QCD_FL_CNFINITIATE") {
                $("#divUserRole21 #btnReject1").show();
            }

            if (res.process_status == "QCD_FL_EQUPACCEPT") {
                $("#divUserRole21 #start").show();
                $("#divUserRole21 #reviewEd").hide();
                $("#divUserRole21 #btnApprove1").hide();
                $("#divUserRole21 #btnReject1").hide();
            }
            if (res.process_status == "QCD_FL_EQUPMOVED") {
                $("#divUserRole21 #btnReject1").hide();
            }

            if (res.process_status == "QCD_FL_EQUPEND") {
                $("#divUserRole21 #btnApprove1").show();
                $("#divUserRole21 #start").hide();
                $("#divUserRole21 #reviewEd").hide();
                $("#divUserRole21 #btnReject1").hide();
                $("#txt_transport").removeAttr("readonly");
                $("#txt_transport").prop("disabled", false);
                $("#txt_others").removeAttr("readonly");
                $("#txt_others").prop("disabled", false);
            }
            if (res.process_status == "QCD_FL_EQUPSTART") {
                $("#divUserRole21 #btnReject1").hide();
            }
            if (res.process_status == "QCD_FL_BKGSERINIACCEPTED") {
                $("#divUserRole21 #btnApprove1").hide();
                $("#divUserRole21 #start").hide();
                $("#divUserRole21 #reviewEd").hide();
                $("#divUserRole21 #btnReject1").hide();


            }


        }
    }

</script>
<script>
    function grid_control() {
        var control_Name = [

        ];
        return control_Name;
    }


    function form_control() {
        var control_Name = [
            { "dataCol": "prodc_cate", "controlId": "txt_produ_cate", "type": "Text" }
        ];
        return control_Name;

    }

    function trans_input_data() {
        var trans_coll = [
             { "trasfer": "Yes", "dataCol": "prodc_cate", "controlId": "", "grid_id": "", "grid_row_col": "" },
        ];
        return trans_coll;
    }
    function mandatory() {
        kendo.alert("enter product category")
    }
</script>

<script>
    function grid_bookingHistory(data) {
        try {
            $("#grid_ESP").kendoGrid({
                dataSource: {
                    data: data,
                    schema: {
                        model: {
                            fields: {
                                Booking_ID: { type: "string", editable: false },
                                Equipment: { type: "string", editable: false },
                                Booking_Date: { type: "string", editable: false },
                                Period_From: { type: "string", editable: false },
                                Period_To: { type: "string", editable: false },
                                Rate: { type: "string", editable: false },
                                user_name: { type: "string", editable: false },
                                row_timestamp: { type: "string", editable: false }
                            }
                        }
                    }
                },


                height: 250,
                groupable: false,
                dataBinding: setDefaultValues,

                change: function (e) {
                    $("#grid_ESP tbody .k-state-selected").css({
                        "background-color": "lightgreen"
                    });
                },
                dataBound: function (e) {
                    resultData = e.sender._data;
                    var rows = $('#grid_ESP').data('kendoGrid').tbody.children();
                    setColor(rows, resultData);
                },
                sortable: true,
                selectable: true,
                navigatable: true,

                columns: [
{
    field: "booking_history_rowid",
    title: "booking_history_rowid",
    width: 2,
    hidden: true,
},
{
    field: "booking_rowid",
    title: "booking_rowid",
    width: 2,
    hidden: true,
},
         {
             field: "booking_no",
             title: "Booking ID",
             width: 50,
         },
        {
            field: "equipment_name",
            title: "Equipment",
            width: 100
        },
        {
            field: "booking_date",
            title: "Booking Date",
            width: 60,
        },
         {
             field: "period_from",
             title: "Period From",
             width: 100,
         },

        {
            field: "period_to",
            title: "Period To",
            width: 100
        },


        {
            field: "rate",
            title: "Rate",
            width: 50,
            attributes: { style: "text-align:right;" },
            row: { style: "text-align:right;" },




        },
              {
                  field: "status_desc",
                  title: "Status",
                  width: 50,
              },
         {
             field: "user_name",
             title: "User Name",
             width: 80,
         },
          {
              field: "status_code",
              title: "Row Timestamp",
              width: 80,
          },

       {
           field: "mode_flag",
           title: "Mode",
           hidden: true
       }]

            });

        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>

<script>
    var status_desc_list = "";
    function gridterms1(data) {
        try {
            $("#grid_terms_condition1").kendoGrid({
                dataSource: {
                    data: data,
                    schema: {
                        model: {
                            fields: {
                                termsandconditions_rowid: { type: "string", editable: false },
                                sl_no: { type: "string", editable: false },
                                termsandconditions: { type: "string", editable: false },
                                status_code: { type: "string", editable: false },
                                user_name: { type: "string", editable: false },
                                row_timestamp: { type: "string" },
                                status_desc: { type: "string", editable: false },

                            }
                        }
                    }
                },


                height: 250,
                groupable: false,
                dataBinding: setDefaultValues,

                change: function (e) {
                    $("#grid_terms_condition1 tbody .k-state-selected").css({
                        "background-color": "lightgreen"
                    });
                },
                dataBound: function (e) {
                    resultData = e.sender._data;
                    var rows = $('#grid_terms_condition1').data('kendoGrid').tbody.children();
                    setColor(rows, resultData);
                },
                sortable: true,
                selectable: true,
                navigatable: true,
                columns: [
                    {
                        field: "termsandconditions_rowid",
                        title: "termsandconditions_rowid",
                        hidden: true

                    },
                    {
                        field: "sl_no",
                        title: "SI no",
                        width: 30,


                    },
                    {
                        field: "termsandconditions",
                        title: "Terms and Conditions",
                        width: 100,
                    },

                    {
                        field: "status_code",
                        title: "status_code",
                        hidden: true
                    },
                    {
                        field: "user_name",
                        title: "User Name",
                        width: 30,
                    },
                    {
                        field: "row_timestamp",
                        title: "Row Timestamp",
                        width: 30,

                    },

                    {
                        field: "mode_flag",
                        title: "Mode",
                        hidden: true
                    }],
                editable: true
            });
        }
        catch (err) {
            alert(err);
        }
    }
    //load_master_code();
    status_desc_list = grid_comboScreen_mastercodes("STATUS");


</script>

<script>

    function review() {
        try {
            $("#txtMode").val('R');
            save();
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    function approve() {
        try {

            $("#txtMode").val('A');
            save();
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    function equipmentstart() {
        try {
            $("#txtMode").val('ST');
            save();
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    function servicecompletion() {
        try {
            $("#txtMode").val('SC');
            save();
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }
    function reject() {
        try {
            $("#txtMode").val('J');
            save();
        }
        catch (err) {
            javascript_log4j_root(arguments.callee.name, err);
        }
    }

</script>
<style>
    .k-grid-header th.k-header, .k-filter-row th {
        text-align: left;
    }
</style>